<?php

return <<<'VALUE'
"namespace IPS\\Theme;\nclass class_gallery_front_global extends \\IPS\\Theme\\Template\n{\n\tpublic $cache_key = '09b1a41bbf9d26c23c910cbce97da48f';\n\tfunction approvalQueueItem( $item, $ref, $container, $title ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n<div id=\"elApprovePanel\" class='ipsBox'>\n\t<article class=\"ipsClearfix ipsClear\">\n\t\t<div class='ipsPad'>\n\t\t\t<p class=\"ipsPos_right ipsPad_half\">\n\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $item->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' class='ipsType_normal ipsType_light'>\n\t\t\t\t\t<i class='fa fa-\nCONTENT;\n$return .= htmlspecialchars( $item::$icon, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'><\/i> \nCONTENT;\n\n$val = \"{$item::$title}\"; $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( $val, ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t\t\t<\/a>\n\t\t\t<\/p>\n\t\t\t<div class=\"ipsPhotoPanel ipsPhotoPanel_small ipsClearfix\"> \n\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \\IPS\\Request::i()->app )->userPhoto( $item->author() );\n$return .= <<<CONTENT\n\n\t\t\t\t<div>\n\t\t\t\t\t<a href=\"#user\nCONTENT;\n$return .= htmlspecialchars( $item->author()->member_id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_menu\" id=\"user\nCONTENT;\n$return .= htmlspecialchars( $item->author()->member_id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class=\"ipsType_sectionHead\" data-ipsmenu=\"\">\nCONTENT;\n$return .= htmlspecialchars( $item->author()->name, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n &nbsp;<i class=\"fa fa-caret-down\"><\/i><\/a>\n\t\t\t\t\t<ul class=\"ipsMenu ipsMenu_auto ipsMenu_withStem ipsHide\" id=\"user\nCONTENT;\n$return .= htmlspecialchars( $item->author()->member_id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_menu\">\n\t\t\t\t\t\t\nCONTENT;\n\nif ( \\IPS\\Member::loggedIn()->modPermission('mod_can_warn') ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nCONTENT;\n\n$return .= htmlspecialchars( \\IPS\\Http\\Url::internal( \"app=core&module=system&controller=warnings&do=warn&id={$item->author()->member_id}&ref={$ref}\", null, \"warn_add\", array( $item->author()->members_seo_name ), 0 ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', TRUE );\n$return .= <<<CONTENT\n' data-ipsDialog data-ipsDialog-title=\"\nCONTENT;\n\n$sprintf = array($item->author()->name); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'warn_member', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\" data-ipsDialog-remoteSubmit data-ipsDialog-flashMessage=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'warning_issued', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\" data-role=\"warnUserDialog\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'warn_user', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n\nif ( $item->author()->member_id != \\IPS\\Member::loggedIn()->member_id ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $item->author()->members_bitoptions['bw_is_spammer'] ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<li class='ipsMenu_item' data-ipsMenuValue='spamFlagButton'><a href='\nCONTENT;\n\n$return .= htmlspecialchars( \\IPS\\Http\\Url::internal( \"app=core&module=system&controller=moderation&do=flagAsSpammer&id={$item->author()->member_id}&s=0\" . \"&csrfKey=\" . \\IPS\\Session::i()->csrfKey, null, \"flag_as_spammer\", array( $item->author()->members_seo_name ), 0 ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', TRUE );\n$return .= <<<CONTENT\n' data-confirm data-confirmSubMessage=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'spam_unflag_confirm', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'spam_unflag', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<li class='ipsMenu_item' data-ipsMenuValue='spamFlagButton'><a href='\nCONTENT;\n\n$return .= htmlspecialchars( \\IPS\\Http\\Url::internal( \"app=core&module=system&controller=moderation&do=flagAsSpammer&id={$item->author()->member_id}&s=1\" . \"&csrfKey=\" . \\IPS\\Session::i()->csrfKey, null, \"flag_as_spammer\", array( $item->author()->members_seo_name ), 0 ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', TRUE );\n$return .= <<<CONTENT\n' data-confirm>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'spam_flag', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<li class=\"ipsMenu_item\"><a href='\nCONTENT;\n\n$return .= htmlspecialchars( \\IPS\\Http\\Url::internal( \"app=core&module=messaging&controller=messenger&do=compose&to={$item->author()->member_id}\", null, \"messenger_compose\", array(), 0 ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', TRUE );\n$return .= <<<CONTENT\n' data-ipsDialog data-ipsDialog-title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'compose_new', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n' data-ipsDialog-remoteSubmit data-ipsDialog-flashMessage=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'message_sent', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'message_send', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t<\/ul>\n\t\t\t\t\t\nCONTENT;\n\nif ( $container ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<p class='ipsType_reset'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'posted_in_container', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n <a href=\"\nCONTENT;\n$return .= htmlspecialchars( $container->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\nCONTENT;\n$return .= htmlspecialchars( $container->_title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/a><\/p>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t<p class=\"ipsType_light ipsType_reset\">\nCONTENT;\n\n$htmlsprintf = array(\\IPS\\DateTime::ts( $item->mapped('date') )->html(FALSE)); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'date_replied', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'htmlsprintf' => $htmlsprintf ) );\n$return .= <<<CONTENT\n<\/p>\n\t\t\t\t<\/p><\/div>\n\t\t\t<\/div>\n\t\t<\/div>\n\t\t<div class='ipsAreaBackground_light ipsPad'>\n\t\t\t<div class='ipsBox'>\n\t\t\t\t<h2 class=\"ipsType_sectionTitle ipsType_blendLinks\"><a href=\"\nCONTENT;\n$return .= htmlspecialchars( $item->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\nCONTENT;\n$return .= htmlspecialchars( $title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/a><\/h2>\n\t\t\t\t<div class=\"ipsType_richText ipsPost ipsType_normal ipsPad\">\n\t\t\t\t\t\nCONTENT;\n\nif ( $item->masked_file_name ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $item->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\n\t\t\t\t\t\t\t<img src='\nCONTENT;\n\n$return .= \\IPS\\File::get( \"gallery_Images\", $item->masked_file_name )->url;\n$return .= <<<CONTENT\n' alt=\"\nCONTENT;\n$return .= htmlspecialchars( $item->caption, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\n\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $item->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\n\t\t\t\t\t\t\t<div class='ipsNoThumb ipsNoThumb_video cSearchActivity_image'><\/div>\n\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t<\/div>\n\t<\/article>\n<\/div>\n\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction comment( $item, $comment, $editorName, $app, $type, $class='' ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\nCONTENT;\n\n$idField = $comment::$databaseColumnId;\n$return .= <<<CONTENT\n\n<div id='comment-\nCONTENT;\n$return .= htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_wrap' data-controller='core.front.core.comment' data-commentApp='\nCONTENT;\n$return .= htmlspecialchars( $app, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-commentType='\nCONTENT;\n$return .= htmlspecialchars( $type, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-commentID=\"\nCONTENT;\n$return .= htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" data-quoteData='\nCONTENT;\n\n$return .= htmlspecialchars( json_encode( array('userid' => $comment->author()->member_id, 'username' => $comment->author()->name, 'timestamp' => $comment->mapped('date'), 'contentapp' => $app, 'contenttype' => $type, 'contentclass' => $class, 'contentid' => $item->id, 'contentcommentid' => $comment->$idField) ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' class='ipsComment_content ipsType_medium'>\n\t\n\t\nCONTENT;\n\nif ( $comment->author()->hasHighlightedReplies() || ( \\IPS\\Settings::i()->reputation_enabled and \\IPS\\IPS::classUsesTrait( $comment, 'IPS\\Content\\Reactable' ) and \\IPS\\Settings::i()->reputation_highlight and $comment->reactionCount() >= \\IPS\\Settings::i()->reputation_highlight ) OR $comment->isFeatured() ):\n$return .= <<<CONTENT\n\n\t\t<div class='ipsPadding_horizontal ipsPadding_top ipsComment_badges'>\n\t\t\t<ul class='ipsList_reset ipsFlex ipsFlex-fw:wrap ipsGap:2 ipsGap_row:1'>\n\t\t\t\t\nCONTENT;\n\nif ( $comment->author()->hasHighlightedReplies() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li><strong class='ipsBadge ipsBadge_large ipsBadge_highlightedGroup'>\nCONTENT;\n\n$return .= \\IPS\\Member\\Group::load( $comment->author()->member_group_id )->name;\n$return .= <<<CONTENT\n<\/strong><\/li>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nif ( $comment->isFeatured() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li><strong class='ipsBadge ipsBadge_large ipsBadge_popular'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'this_is_a_featured_post', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/strong><\/li>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nif ( ( \\IPS\\Settings::i()->reputation_enabled and \\IPS\\Settings::i()->reputation_highlight and $comment->reactionCount() >= \\IPS\\Settings::i()->reputation_highlight )  ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li><strong class='ipsBadge ipsBadge_large ipsBadge_popular'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'this_is_a_popular_comment', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/strong><\/li>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t<\/ul>\n\t\t<\/div>\n\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\n\t<div class='ipsComment_header ipsFlex ipsFlex-ai:start ipsFlex-jc:between'>\n\t\t<div class='ipsPhotoPanel ipsPhotoPanel_mini'>\n\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\" )->userPhoto( $comment->author(), 'mini', $comment->warningRef() );\n$return .= <<<CONTENT\n\n\t\t\t<div>\n\t\t\t\t<h3 class='ipsComment_author ipsType_blendLinks'>\n\t\t\t\t\t<strong class='ipsType_normal'>\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\" )->userLink( $comment->author(), $comment->warningRef(), NULL, $comment->isAnonymous() );\n$return .= <<<CONTENT\n<\/strong>\n\t\t\t\t\t\nCONTENT;\n\nif ( $comment instanceof \\IPS\\Content\\Anonymous and $comment->isAnonymous() and \\IPS\\Member::loggedIn()->modPermission('can_view_anonymous_posters') ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<a data-ipsHover data-ipsHover-width=\"370\" data-ipsHover-onClick href=\"\nCONTENT;\n$return .= htmlspecialchars( $comment->url( 'reveal' )->csrf(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\"><span class=\"cAuthorPane_badge cAuthorPane_badge_small cAuthorPane_badge--anon\" data-ipsTooltip title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'post_anonymously_reveal', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\"><\/span><\/a>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\" )->reputationBadge( $comment->author() );\n$return .= <<<CONTENT\n\n\t\t\t\t<\/h3>\n\t\t\t\t<p class='ipsComment_meta ipsType_light ipsType_medium'>\n\t\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $comment->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' class='ipsType_blendLinks'>{$comment->dateLine()}<\/a>\n\t\t\t\t\t\nCONTENT;\n\nif ( $comment->ip_address and \\IPS\\Member::loggedIn()->modPermission('can_use_ip_tools') and \\IPS\\Member::loggedIn()->canAccessModule( \\IPS\\Application\\Module::get( 'core', 'modcp' ) ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t&middot; <a class='ipsType_blendLinks ipsType_light ipsType_noUnderline' href=\"\nCONTENT;\n\n$return .= htmlspecialchars( \\IPS\\Http\\Url::internal( \"app=core&module=modcp&controller=modcp&tab=ip_tools&ip=$comment->ip_address\", null, \"modcp_ip_tools\", array(), 0 ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', TRUE );\n$return .= <<<CONTENT\n\" data-ipsMenu data-ipsMenu-menuID='\nCONTENT;\n$return .= htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_ip_menu'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'ip_short', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n <i class='fa fa-angle-down'><\/i><\/a>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nif ( $comment->editLine() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t(\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'edited_lc', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n)\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nif ( $comment->hidden() AND $comment->hidden() != -2 ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t&middot; \nCONTENT;\n$return .= htmlspecialchars( $comment->hiddenBlurb(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nelseif ( $comment->hidden() == -2 ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t&middot; \nCONTENT;\n$return .= htmlspecialchars( $comment->deletedBlurb(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/p>\n\n\t\t\t\t\nCONTENT;\n\nif ( \\IPS\\Member::loggedIn()->modPermission('mod_see_warn') and $comment->warning ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\" )->commentWarned( $comment );\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t<\/div>\n\t\t<\/div>\n\t\t<div class='ipsType_reset ipsType_light ipsType_blendLinks ipsComment_toolWrap'>\n\t\t\t\nCONTENT;\n\nif ( $comment->hidden() !== 1 && ( $comment->canReportOrRevoke() === TRUE || \\count( $comment->sharelinks() ) || $comment->canEdit() || $comment->canPromoteToSocialMedia() || $comment->canDelete() || $comment->canSplit() || ( $comment instanceof \\IPS\\Content\\Hideable AND ( ( !$comment->hidden() and $comment->canHide() ) || ( $comment->hidden() and $comment->canUnhide() ) ) ) || ( $comment->hidden() == -2 AND \\IPS\\Member::loggedIn()->modPermission('can_manage_deleted_content') ) || \\count( $item->commentMultimodActions() ) ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t<ul class='ipsList_reset ipsComment_tools'>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<a href='#elControlsComments_\nCONTENT;\n$return .= htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_menu' class='ipsComment_ellipsis' id='elControlsComments_\nCONTENT;\n$return .= htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-ipsMenu data-ipsMenu-appendTo='#comment-\nCONTENT;\n$return .= htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_wrap'><i class='fa fa-ellipsis-h'><\/i><\/a>\n\t\t\t\t\t\t<ul id='elControlsComments_\nCONTENT;\n$return .= htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_menu' class='ipsMenu ipsMenu_narrow ipsHide'>\n\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $comment->canReportOrRevoke() === TRUE ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nCONTENT;\n$return .= htmlspecialchars( $comment->url('report'), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' \nCONTENT;\n\nif ( \\IPS\\Member::loggedIn()->member_id or \\IPS\\Helpers\\Form\\Captcha::supportsModal() ):\n$return .= <<<CONTENT\ndata-ipsDialog data-ipsDialog-remoteSubmit data-ipsDialog-size='medium' data-ipsDialog-flashMessage='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'report_submit_success', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n' data-ipsDialog-title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'report', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\"\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n data-action='reportComment' title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'report_content', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'report', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nCONTENT;\n$return .= htmlspecialchars( $comment->item()->url()->setQueryString( array( 'do' => 'findComment', 'comment' => $comment->id ) ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-ipsDialog data-ipsDialog-size='narrow' data-ipsDialog-content='#elShareComment_\nCONTENT;\n$return .= htmlspecialchars( $comment->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_menu' data-ipsDialog-title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'share_this_comment', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\" id='elShareComment_\nCONTENT;\n$return .= htmlspecialchars( $comment->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-role='shareComment'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'share', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $comment->canReportOrRevoke() === TRUE || \\count( $comment->sharelinks() ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $comment->canEdit() || $comment->canPromoteToSocialMedia() || $comment->canDelete() || $comment->canSplit() || ( $comment instanceof \\IPS\\Content\\Hideable AND ( ( !$comment->hidden() and $comment->canHide() ) || ( $comment->hidden() and $comment->canUnhide() ) ) ) || ( $comment->hidden() == -2 AND \\IPS\\Member::loggedIn()->modPermission('can_manage_deleted_content') ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<li class='ipsMenu_sep'><hr><\/li>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $comment->canEdit() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $comment->mapped('first') and $comment->item()->canEdit() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nCONTENT;\n$return .= htmlspecialchars( $comment->item()->url()->setQueryString( 'do', 'edit' ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'edit', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nCONTENT;\n$return .= htmlspecialchars( $comment->url('edit'), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-action='editComment'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'edit', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $comment->hidden() == -2 AND \\IPS\\Member::loggedIn()->modPermission('can_manage_deleted_content') ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nCONTENT;\n$return .= htmlspecialchars( $comment->url('restore')->csrf(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-confirm data-confirmSubMessage='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'restore_as_visible_desc', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'restore_as_visible', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nCONTENT;\n$return .= htmlspecialchars( $comment->url('restore')->csrf()->setQueryString( 'restoreAsHidden', 1 ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-confirm data-confirmSubMessage='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'restore_as_hidden_desc', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'restore_as_hidden', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nCONTENT;\n$return .= htmlspecialchars( $comment->url('delete')->csrf()->setQueryString( 'immediately', 1 ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-confirm data-confirmSubMessage='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'delete_immediately_desc', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'delete_immediately', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $comment instanceof \\IPS\\Content\\Hideable ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( !$comment->hidden() and $comment->canHide() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nCONTENT;\n$return .= htmlspecialchars( $comment->url('hide'), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-ipsDialog data-ipsDialog-title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'hide', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'hide', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nelseif ( $comment->hidden() and $comment->canUnhide() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nCONTENT;\n$return .= htmlspecialchars( $comment->url('unhide')->csrf(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'unhide', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $comment->canSplit() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nCONTENT;\n$return .= htmlspecialchars( $comment->url('split'), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-action='splitComment' data-ipsDialog data-ipsDialog-title=\"\nCONTENT;\n\n$sprintf = array(\\IPS\\Member::loggedIn()->language()->addToStack( $item::$title )); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'split_to_new', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'split', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $comment->canDelete() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nCONTENT;\n$return .= htmlspecialchars( $comment->url('delete')->csrf()->setPage('page',\\IPS\\Request::i()->page), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-action='deleteComment' data-updateOnDelete=\"#commentCount\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'delete', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $comment->isFeatured() AND $item->canUnfeatureComment() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nCONTENT;\n$return .= htmlspecialchars( $comment->url('unfeature')->csrf()->setPage('page',\\IPS\\Request::i()->page), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-action=\"unrecommendComment\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'unrecommend_content', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( !$comment->isFeatured() AND $item->canFeatureComment() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nCONTENT;\n$return .= htmlspecialchars( $comment->url('feature')->setPage('page', \\IPS\\Request::i()->page), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-ipsDialog data-ipsDialog-title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'recommend_comment', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n' data-ipsDialog-remoteSubmit data-ipsDialog-size='narrow' data-action=\"recommendComment\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'recommend_content', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $comment->canPromoteToSocialMedia() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<li class='ipsMenu_item'>\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\" )->promoteLink( $comment );\n$return .= <<<CONTENT\n<\/li>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<\/ul>\n\t\t\t\t\t<\/li>\n\t\t\t\t\t\nCONTENT;\n\nif ( \\count( $item->commentMultimodActions() ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<li><span class='ipsCustomInput'>\n\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"multimod[\nCONTENT;\n$return .= htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n]\" value=\"1\" data-role=\"moderation\" data-actions=\"\nCONTENT;\n\nif ( $comment->canSplit() ):\n$return .= <<<CONTENT\nsplit merge\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n \nCONTENT;\n\nif ( $comment->hidden() === -1 AND $comment->canUnhide() ):\n$return .= <<<CONTENT\nunhide\nCONTENT;\n\nelseif ( $comment->hidden() === 1 AND $comment->canUnhide() ):\n$return .= <<<CONTENT\napprove\nCONTENT;\n\nelseif ( $comment->canHide() ):\n$return .= <<<CONTENT\nhide\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n \nCONTENT;\n\nif ( $comment->canDelete() ):\n$return .= <<<CONTENT\ndelete\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\" data-state='\nCONTENT;\n\nif ( $comment->tableStates() ):\n$return .= <<<CONTENT\n\nCONTENT;\n$return .= htmlspecialchars( $comment->tableStates(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n'>\n\t\t\t\t\t\t\t<span><\/span>\n\t\t\t\t\t\t<\/span><\/li>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/ul>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<\/div>\n\t<\/div>\n\t<div class='ipsPadding sm:ipsPadding_vertical:half'>\n\t\t<div data-role='commentContent' class='ipsType_normal ipsType_richText ipsContained' data-controller='core.front.core.lightboxedImages'>\n\t\t\t\nCONTENT;\n\nif ( $comment->hidden() === 1 && $comment->author()->member_id == \\IPS\\Member::loggedIn()->member_id ):\n$return .= <<<CONTENT\n\n\t\t\t\t<strong class='ipsType_medium ipsType_warning'><i class='fa fa-info-circle'><\/i> \nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'comment_awaiting_approval', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/strong>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t{$comment->content()}\n\n\t\t\t\nCONTENT;\n\nif ( $comment->editLine() ):\n$return .= <<<CONTENT\n\n\t\t\t\t{$comment->editLine()}\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<\/div>\n\t<\/div>\n\t\nCONTENT;\n\nif ( ( $comment->hidden() !== 1 && \\IPS\\IPS::classUsesTrait( $comment, 'IPS\\Content\\Reactable' ) and \\IPS\\Settings::i()->reputation_enabled and $comment->hasReactionBar() ) || ( $comment->hidden() === 1 && ( $comment->canUnhide() || $comment->canDelete() ) ) || ( $comment->hidden() === 0 and $item->canComment() and $editorName )  ):\n$return .= <<<CONTENT\n\n\t\t<div class='ipsItemControls'>\n\t\t\t\nCONTENT;\n\nif ( $comment->hidden() !== 1 && \\IPS\\IPS::classUsesTrait( $comment, 'IPS\\Content\\Reactable' ) and \\IPS\\Settings::i()->reputation_enabled and $comment->hasReactionBar() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\" )->reputation( $comment );\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t<ul class='ipsComment_controls ipsClearfix ipsItemControls_left' data-role=\"commentControls\">\n\t\t\t\t\nCONTENT;\n\nif ( $comment->hidden() === 1 && ( $comment->canUnhide() || $comment->canDelete() ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nif ( $comment->canUnhide() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<li><a href='\nCONTENT;\n$return .= htmlspecialchars( $comment->url('unhide')->csrf(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' class='ipsButton ipsButton_verySmall ipsButton_positive' data-action='approveComment'><i class='fa fa-check'><\/i> \nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'approve', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nif ( $comment->canDelete() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<li><a href='\nCONTENT;\n$return .= htmlspecialchars( $comment->url('delete')->csrf()->setPage('page',\\IPS\\Request::i()->page), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-action='deleteComment' data-updateOnDelete=\"#commentCount\" class='ipsButton ipsButton_verySmall ipsButton_negative'><i class='fa fa-times'><\/i> \nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'delete', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nif ( $comment->canEdit() || $comment->canSplit() || $comment->canHide() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t<a href='#elControlsCommentsSub_\nCONTENT;\n$return .= htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_menu' id='elControlsCommentsSub_\nCONTENT;\n$return .= htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-ipsMenu data-ipsMenu-appendTo='#comment-\nCONTENT;\n$return .= htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_wrap'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'moderator_tools', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n &nbsp;<i class='fa fa-caret-down'><\/i><\/a>\n\t\t\t\t\t\t\t<ul id='elControlsCommentsSub_\nCONTENT;\n$return .= htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_menu' class='ipsMenu ipsMenu_narrow ipsHide'>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $comment->canEdit() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $comment->mapped('first') and $comment->item()->canEdit() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nCONTENT;\n$return .= htmlspecialchars( $comment->item()->url()->setQueryString( 'do', 'edit' ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'edit', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nCONTENT;\n$return .= htmlspecialchars( $comment->url('edit'), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-action='editComment'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'edit', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $comment->canSplit() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nCONTENT;\n$return .= htmlspecialchars( $comment->url('split'), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-action='splitComment' data-ipsDialog data-ipsDialog-title=\"\nCONTENT;\n\n$sprintf = array(\\IPS\\Member::loggedIn()->language()->addToStack( $item::$title )); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'split_to_new', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'split', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $comment instanceof \\IPS\\Content\\Hideable and $comment->canHide() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nCONTENT;\n$return .= htmlspecialchars( $comment->url('hide')->csrf(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-ipsDialog data-ipsDialog-title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'hide', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'hide', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<\/ul>\n\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nif ( $comment->hidden() === 0 and $item->canComment() and $editorName ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<li data-ipsQuote-editor='\nCONTENT;\n$return .= htmlspecialchars( $editorName, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-ipsQuote-target='#comment-\nCONTENT;\n$return .= htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' class='ipsJS_show'>\n\t\t\t\t\t\t\t<button class='ipsButton ipsButton_light ipsButton_verySmall ipsButton_narrow cMultiQuote ipsHide' data-action='multiQuoteComment' data-ipsTooltip data-ipsQuote-multiQuote data-mqId='mq\nCONTENT;\n$return .= htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'multiquote', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n'><i class='fa fa-plus'><\/i><\/button>\n\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t<li data-ipsQuote-editor='\nCONTENT;\n$return .= htmlspecialchars( $editorName, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-ipsQuote-target='#comment-\nCONTENT;\n$return .= htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' class='ipsJS_show'>\n\t\t\t\t\t\t\t<a href='#' data-action=\"quoteComment\" data-ipsQuote-singleQuote>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'quote', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<li class='ipsHide' data-role='commentLoading'>\n\t\t\t\t\t<span class='ipsLoading ipsLoading_tiny ipsLoading_noAnim'><\/span>\n\t\t\t\t<\/li>\n\t\t\t<\/ul>\n\t\t<\/div>\n\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\n\t\nCONTENT;\n\nif ( $comment->ip_address and \\IPS\\Member::loggedIn()->modPermission('can_use_ip_tools') and \\IPS\\Member::loggedIn()->canAccessModule( \\IPS\\Application\\Module::get( 'core', 'modcp' ) ) ):\n$return .= <<<CONTENT\n\n\t<div class='ipsHide ipsPadding ipsMenu ipsMenu_veryWide' id='\nCONTENT;\n$return .= htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_ip_menu'>\n\t\t\t<h5 class='ipsType_normal ipsType_reset'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'ip_address', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h5>\n\t\t\t<input type='text' autofocus class='ipsField_fullWidth ipsMargin_vertical:half' value='\nCONTENT;\n$return .= htmlspecialchars( $comment->ip_address, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\n\t\t\t<a href='\nCONTENT;\n\n$return .= htmlspecialchars( \\IPS\\Http\\Url::internal( \"app=core&module=modcp&controller=modcp&tab=ip_tools&ip=$comment->ip_address\", null, \"modcp_ip_tools\", array(), 0 ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', TRUE );\n$return .= <<<CONTENT\n' class='ipsButton ipsButton_light ipsButton_small ipsButton_fullWidth'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'more_about_ip_address', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n <i class='fa fa-angle-right'><\/i><\/a>\n\t\t<\/div>\n\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\" )->sharemenu( $comment );\n$return .= <<<CONTENT\n\n<\/div>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction commentContainer( $item, $comment ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\nCONTENT;\n\n$idField = $comment::$databaseColumnId;\n$return .= <<<CONTENT\n\n\nCONTENT;\n\n$itemClassSafe = str_replace( '\\\\', '_', mb_substr( $comment::$itemClass, 4 ) );\n$return .= <<<CONTENT\n\n\nCONTENT;\n\nif ( $comment->isIgnored() ):\n$return .= <<<CONTENT\n\n\t<div class='ipsComment ipsComment_ignored ipsPad_half ipsType_light' id='elIgnoreComment_\nCONTENT;\n$return .= htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-ignoreCommentID='elComment_\nCONTENT;\n$return .= htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-ignoreUserID='\nCONTENT;\n$return .= htmlspecialchars( $comment->author()->member_id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\n\t\t\nCONTENT;\n\n$sprintf = array($comment->author()->name); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'ignoring_content', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n <a href='#elIgnoreComment_\nCONTENT;\n$return .= htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_menu' data-ipsMenu data-ipsMenu-menuID='elIgnoreComment_\nCONTENT;\n$return .= htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_menu' data-ipsMenu-appendTo='#elIgnoreComment_\nCONTENT;\n$return .= htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-action=\"ignoreOptions\" title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'see_post_ignore_options', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n' class='ipsType_blendLinks'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'options', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n <i class='fa fa-caret-down'><\/i><\/a>\n\t\t<ul class='ipsMenu ipsHide' id='elIgnoreComment_\nCONTENT;\n$return .= htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_menu'>\n\t\t\t<li class='ipsMenu_item' data-ipsMenuValue='showPost'><a href='#'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'show_this_comment', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t<li class='ipsMenu_sep'><hr><\/li>\n\t\t\t<li class='ipsMenu_item' data-ipsMenuValue='stopIgnoring'><a href='\nCONTENT;\n\n$return .= htmlspecialchars( \\IPS\\Http\\Url::internal( \"app=core&module=system&controller=ignore&do=remove&id={$comment->author()->member_id}\", null, \"ignore\", array(), 0 ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', TRUE );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$sprintf = array($comment->author()->name); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'stop_ignoring_posts_by', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t<li class='ipsMenu_item'><a href='\nCONTENT;\n\n$return .= htmlspecialchars( \\IPS\\Http\\Url::internal( \"app=core&module=system&controller=ignore\", null, \"ignore\", array(), 0 ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', TRUE );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'change_ignore_preferences', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t<\/ul>\n\t<\/div>\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\n<a id='comment-\nCONTENT;\n$return .= htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'><\/a>\n<article \nCONTENT;\n\nif ( $comment->author()->hasHighlightedReplies() ):\n$return .= <<<CONTENT\ndata-memberGroup=\"\nCONTENT;\n$return .= htmlspecialchars( $comment->author()->member_group_id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" \nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n id='elComment_\nCONTENT;\n$return .= htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' class='ipsBox ipsBox--child ipsComment \nCONTENT;\n\nif ( ( \\IPS\\Settings::i()->reputation_enabled and \\IPS\\IPS::classUsesTrait( $comment, 'IPS\\Content\\Reactable' ) and \\IPS\\Settings::i()->reputation_highlight and $comment->reactionCount() >= \\IPS\\Settings::i()->reputation_highlight ) OR $comment->isFeatured() ):\n$return .= <<<CONTENT\nipsComment_popular\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n ipsComment_parent ipsClearfix ipsClear \nCONTENT;\n\nif ( $comment->isIgnored() ):\n$return .= <<<CONTENT\nipsHide\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n \nCONTENT;\n\nif ( $comment->author()->hasHighlightedReplies() ):\n$return .= <<<CONTENT\nipsComment_highlighted\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n \nCONTENT;\n\nif ( $comment->hidden() OR $item->hidden() == -2 ):\n$return .= <<<CONTENT\nipsModerated\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n'>\n\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"gallery\" )->comment( $item, $comment, $item::$formLangPrefix . 'comment', $item::$application, $item::$module, $itemClassSafe );\n$return .= <<<CONTENT\n\n<\/article>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction commentTableHeader( $comment, $image ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\n<div class='ipsFlex ipsFlex-ai:center sm:ipsFlex-ai:start sm:ipsMargin_top:double'>\n\t<div class='ipsFlex-flex:00 ipsMargin_right sm:ipsMargin_right:half'>\n\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\" )->thumbImage( $image->small_file_name, $image->caption, 'small', '', 'view_this', $image->url(), 'gallery_Images' );\n$return .= <<<CONTENT\n\n\t<\/div>\n\t<div class='ipsType_break'>\n\t\t<h3 class='ipsType_sectionHead'><a href='\nCONTENT;\n$return .= htmlspecialchars( $image->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' title='\nCONTENT;\n\n$sprintf = array($image->caption); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'view_this_image', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n'>\nCONTENT;\n$return .= htmlspecialchars( $image->caption, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/a><\/h3>\n\t\t<p class='ipsType_normal ipsType_light ipsType_blendLinks ipsType_reset'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'in', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n <a href='\nCONTENT;\n$return .= htmlspecialchars( $image->container()->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\nCONTENT;\n$return .= htmlspecialchars( $image->container()->_title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/a><\/p>\n\t\t\nCONTENT;\n\nif ( $image->container()->allow_rating ):\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\", 'front' )->rating( 'large', $image->rating );\n$return .= <<<CONTENT\n &nbsp;&nbsp;\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\n\t\t<span class='ipsType_medium ipsType_reset'>\nCONTENT;\n\nif ( $image->container()->allow_comments ):\n$return .= <<<CONTENT\n&nbsp;&nbsp;\nCONTENT;\n\nif ( !$image->comments ):\n$return .= <<<CONTENT\n<span class='ipsType_light'>\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n<i class='fa fa-comment'><\/i> \nCONTENT;\n$return .= htmlspecialchars( $image->comments, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\nCONTENT;\n\nif ( !$image->comments ):\n$return .= <<<CONTENT\n<\/span>\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n<\/span>\n\t<\/div>\n<\/div>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction embedAlbumComment( $comment, $item, $url ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\n<div data-embedInfo-maxSize='\nCONTENT;\n\nif ( \\IPS\\Settings::i()->max_internalembed_width ):\n$return .= <<<CONTENT\n\nCONTENT;\n\n$return .= \\IPS\\Settings::i()->max_internalembed_width;\n$return .= <<<CONTENT\n\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n100%\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n' class='ipsRichEmbed'>\n\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"embed\", \"core\" )->embedHeader( $comment, $item->mapped('title'), $comment->mapped('date'), $url );\n$return .= <<<CONTENT\n\n\t<div class='ipsPad_double'>\n\t\t<div class='ipsRichEmbed_originalItem ipsAreaBackground_reset ipsSpacer_bottom ipsType_blendLinks'>\n\t\t\t<div>\n\t\t\t\t\nCONTENT;\n\n$images = \\IPS\\Gallery\\Image::getItemsWithPermission( array( array( 'image_album_id=?', $item->asNode()->id ) ), ( $item->asNode()->sort_options == 'title' ) ? 'image_caption ASC' : \\IPS\\gallery\\Image::$databasePrefix . \\IPS\\gallery\\Image::$databaseColumnMap[ $item->asNode()->sort_options ] . ' DESC', 19 );\n$return .= <<<CONTENT\n\n\n\t\t\t\t\nCONTENT;\n\nif ( \\count( $images ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<ul class='ipsList_reset cGalleryEmbed_albumStrip cGalleryEmbed_albumStrip_mini ipsAreaBackground_reset ipsClearfix'>\n\t\t\t\t\t\t\nCONTENT;\n\nforeach ( $images as $albumImage ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $albumImage->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' style='background-image: url( \"\nCONTENT;\n\n$return .= str_replace( array( '(', ')' ), array( '\\(', '\\)' ), \\IPS\\File::get( 'gallery_Images', $albumImage->small_file_name )->url );;\n$return .= <<<CONTENT\n\") '>\n\t\t\t\t\t\t\t\t\t<img src='\nCONTENT;\n\n$return .= \\IPS\\File::get( \"gallery_Images\", $albumImage->small_file_name )->url;\n$return .= <<<CONTENT\n' class='ipsHide'>\n\t\t\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\n\t\t\t\t\t\t\nCONTENT;\n\nif ( $item->asNode()->count_imgs > 19 ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<li class='cGalleryEmbed_albumStrip_last ipsAreaBackground'>\n\t\t\t\t\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $item->asNode()->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'><span>+\nCONTENT;\n\n$return .= htmlspecialchars( $item->asNode()->count_imgs - 19, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/span><\/a>\n\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t<\/ul>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<div class='ipsPad'>\n\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"embed\", \"core\" )->embedOriginalItem( $item );\n$return .= <<<CONTENT\n\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t<\/div>\n\n\t\t<div class='ipsType_richText ipsType_medium' data-truncate='3'>\n\t\t\t{$comment->truncated(TRUE)}\n\t\t<\/div>\n\n\t\t\nCONTENT;\n\nif ( \\IPS\\Settings::i()->reputation_enabled and \\IPS\\IPS::classUsesTrait( $comment, 'IPS\\Content\\Reactable' ) and \\count( $comment->reactions() ) ):\n$return .= <<<CONTENT\n\n\t\t\t<ul class='ipsList_inline ipsSpacer_top ipsSpacer_half'>\n\t\t\t\t<li>\n\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\" )->reactionOverview( $comment, TRUE, 'small' );\n$return .= <<<CONTENT\n\n\t\t\t\t<\/li>\n\t\t\t<\/ul>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t<\/div>\n<\/div>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction embedAlbumReview( $comment, $item, $url ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\n<div data-embedInfo-maxSize='\nCONTENT;\n\nif ( \\IPS\\Settings::i()->max_internalembed_width ):\n$return .= <<<CONTENT\n\nCONTENT;\n\n$return .= \\IPS\\Settings::i()->max_internalembed_width;\n$return .= <<<CONTENT\n\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n100%\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n' class='ipsRichEmbed'>\n\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"embed\", \"core\" )->embedHeader( $comment, $item->mapped('title'), $comment->mapped('date'), $url );\n$return .= <<<CONTENT\n\n\t<div class='ipsPadding'>\n\t\t<div class='ipsRichEmbed_originalItem ipsAreaBackground_reset ipsSpacer_bottom ipsType_blendLinks'>\n\t\t\t<div>\n\t\t\t\t\nCONTENT;\n\n$images = \\IPS\\Gallery\\Image::getItemsWithPermission( array( array( 'image_album_id=?', $item->asNode()->id ) ), ( $item->asNode()->sort_options == 'title' ) ? 'image_caption ASC' : \\IPS\\gallery\\Image::$databasePrefix . \\IPS\\gallery\\Image::$databaseColumnMap[ $item->asNode()->sort_options ] . ' DESC', 19 );\n$return .= <<<CONTENT\n\n\n\t\t\t\t\nCONTENT;\n\nif ( \\count( $images ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<ul class='ipsList_reset cGalleryEmbed_albumStrip cGalleryEmbed_albumStrip_mini ipsAreaBackground_reset ipsClearfix'>\n\t\t\t\t\t\t\nCONTENT;\n\nforeach ( $images as $albumImage ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $albumImage->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' style='background-image: url( \"\nCONTENT;\n\n$return .= str_replace( array( '(', ')' ), array( '\\(', '\\)' ), \\IPS\\File::get( 'gallery_Images', $albumImage->small_file_name )->url );;\n$return .= <<<CONTENT\n\") '>\n\t\t\t\t\t\t\t\t\t<img src='\nCONTENT;\n\n$return .= \\IPS\\File::get( \"gallery_Images\", $albumImage->small_file_name )->url;\n$return .= <<<CONTENT\n' class='ipsHide'>\n\t\t\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\n\t\t\t\t\t\t\nCONTENT;\n\nif ( $item->asNode()->count_imgs > 19 ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<li class='cGalleryEmbed_albumStrip_last ipsAreaBackground'>\n\t\t\t\t\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $item->asNode()->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'><span>+\nCONTENT;\n\n$return .= htmlspecialchars( $item->asNode()->count_imgs - 19, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/span><\/a>\n\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t<\/ul>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<div class='ipsPad'>\n\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"embed\", \"core\" )->embedOriginalItem( $item );\n$return .= <<<CONTENT\n\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t<\/div>\n\n\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\" )->rating( 'veryLarge', $comment->mapped('rating') );\n$return .= <<<CONTENT\n \n\t\t\nCONTENT;\n\nif ( $comment->mapped('votes_total') ):\n$return .= <<<CONTENT\n\n\t\t\t<p class='ipsType_reset ipsType_medium'>{$comment->helpfulLine()}<\/p>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<hr class='ipsHr'>\n\t\t<div class='ipsType_richText ipsType_medium ipsSpacer_top ipsSpacer_half' data-truncate='3'>\n\t\t\t{$comment->truncated(TRUE)}\n\t\t<\/div>\n\n\t\t\nCONTENT;\n\nif ( \\IPS\\Settings::i()->reputation_enabled and \\IPS\\IPS::classUsesTrait( $comment, 'IPS\\Content\\Reactable' ) and \\count( $comment->reactions() ) ):\n$return .= <<<CONTENT\n\n\t\t\t<ul class='ipsList_inline ipsSpacer_top ipsSpacer_half'>\n\t\t\t\t<li>\n\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\" )->reactionOverview( $comment, TRUE, 'small' );\n$return .= <<<CONTENT\n\n\t\t\t\t<\/li>\n\t\t\t<\/ul>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t<\/div>\n<\/div>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction embedAlbums( $albumItem, $albumNode, $url ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\n<div data-embedInfo-maxSize='\nCONTENT;\n\nif ( \\IPS\\Settings::i()->max_internalembed_width ):\n$return .= <<<CONTENT\n\nCONTENT;\n\n$return .= \\IPS\\Settings::i()->max_internalembed_width;\n$return .= <<<CONTENT\n\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n100%\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n' class='ipsRichEmbed'>\n\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"embed\", \"core\" )->embedHeader( $albumItem, $albumItem->mapped('title'), $albumItem->mapped('date'), $url );\n$return .= <<<CONTENT\n\n\t\nCONTENT;\n\nif ( $albumNode->coverPhoto('small') ):\n$return .= <<<CONTENT\n\n\t\t<div class='ipsRichEmbed_masthead ipsRichEmbed_mastheadBg cGalleryEmbed ipsType_center'>\n\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $albumNode->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' style='background-image: url( \"\nCONTENT;\n\n$return .= str_replace( array( '(', ')' ), array( '\\(', '\\)' ), $albumNode->coverPhoto('masked') );;\n$return .= <<<CONTENT\n\" )'>\n\t\t\t\t<img src='\nCONTENT;\n$return .= htmlspecialchars( $albumNode->coverPhoto('masked'), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' class='ipsHide' alt=\"\nCONTENT;\n$return .= htmlspecialchars( $albumItem->name, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\n\t\t\t<\/a>\n\t\t<\/div>\n\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t<br>\n\t\t<br>\n\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\n\t\nCONTENT;\n\n$images = \\IPS\\Gallery\\Image::getItemsWithPermission( array( array( 'image_album_id=?', $albumNode->id ) ), ( $albumNode->sort_options == 'title' ) ? 'image_caption ASC' : \\IPS\\gallery\\Image::$databasePrefix . \\IPS\\gallery\\Image::$databaseColumnMap[ $albumNode->sort_options ] . ' DESC', 4 );\n$return .= <<<CONTENT\n\n\n\t\nCONTENT;\n\nif ( \\count( $images ) ):\n$return .= <<<CONTENT\n\n\t\t<ul class='ipsList_reset cGalleryEmbed_albumStrip ipsAreaBackground_reset ipsClearfix'>\n\t\t\t\nCONTENT;\n\nforeach ( $images as $albumImage ):\n$return .= <<<CONTENT\n\n\t\t\t\t<li>\n\t\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $albumImage->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' style='background-image: url( \"\nCONTENT;\n\n$return .= str_replace( array( '(', ')' ), array( '\\(', '\\)' ), \\IPS\\File::get( 'gallery_Images', $albumImage->small_file_name )->url );;\n$return .= <<<CONTENT\n\") '>\n\t\t\t\t\t\t<img src='\nCONTENT;\n\n$return .= \\IPS\\File::get( \"gallery_Images\", $albumImage->small_file_name )->url;\n$return .= <<<CONTENT\n' class='ipsHide'>\n\t\t\t\t\t<\/a>\n\t\t\t\t<\/li>\n\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\n\t\t\t\nCONTENT;\n\nif ( $albumNode->count_imgs > 4 ):\n$return .= <<<CONTENT\n\n\t\t\t\t<li class='cGalleryEmbed_albumStrip_last ipsAreaBackground'>\n\t\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $albumNode->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'><span>+\nCONTENT;\n\n$return .= htmlspecialchars( $albumNode->count_imgs - 4, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/span><\/a>\n\t\t\t\t<\/li>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<\/ul>\n\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\n\t<div class='ipsPadding ipsClearfix'>\n\t\t\nCONTENT;\n\nif ( $desc = $albumItem->truncated(TRUE) ):\n$return .= <<<CONTENT\n\n\t\t\t<div class='ipsType_richText ipsType_medium' data-truncate='3'>\n\t\t\t\t{$desc}\n\t\t\t<\/div>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"embed\", \"core\" )->embedItemStats( $albumItem, $albumNode->use_comments );\n$return .= <<<CONTENT\n\n\t<\/div>\n<\/div>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction embedImage( $item, $url, $image=NULL ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\n<div data-embedInfo-maxSize='\nCONTENT;\n\nif ( \\IPS\\Settings::i()->max_internalembed_width ):\n$return .= <<<CONTENT\n\nCONTENT;\n\n$return .= \\IPS\\Settings::i()->max_internalembed_width;\n$return .= <<<CONTENT\n\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n100%\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n' class='ipsRichEmbed'>\n\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"embed\", \"core\" )->embedHeader( $item, $item->mapped('title'), $item->mapped('date'), $url );\n$return .= <<<CONTENT\n\n\t\nCONTENT;\n\nif ( $item->media  ):\n$return .= <<<CONTENT\n\n\t\t<span class='ipsThumb ipsNoThumb ipsNoThumb_video ipsThumb_embed'>\n\t\t\t<div class='cGallery_videoContainer_embedded'>\n\t\t\t\t<video data-controller=\"core.global.core.embeddedvideo\" id=\"elGalleryVideo\" data-role=\"video\" class=\"ipsPos_center\" controls preload=\"auto\" width=\"100%\" height=\"100%\"\nCONTENT;\n\nif ( $item->masked_file_name  ):\n$return .= <<<CONTENT\n poster=\"\nCONTENT;\n\n$return .= \\IPS\\File::get( \"gallery_Images\", $item->masked_file_name )->url;\n$return .= <<<CONTENT\n\"\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n>\n\t\t\t\t\t<source src=\"\nCONTENT;\n\n$return .= \\IPS\\File::get( \"gallery_Images\", $item->original_file_name )->url;\n$return .= <<<CONTENT\n\" type='\nCONTENT;\n$return .= htmlspecialchars( $item->file_type, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' \/>\n\t\t\t\t\t<embed wmode=\"opaque\" autoplay=\"true\" showcontrols=\"true\" showstatusbar=\"true\" showtracker=\"true\" src=\"\nCONTENT;\n\n$return .= \\IPS\\File::get( \"gallery_Images\", $item->original_file_name )->url;\n$return .= <<<CONTENT\n\" width=\"480\" height=\"360\" type='\nCONTENT;\n$return .= htmlspecialchars( $item->file_type, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' \/>\n\t\t\t\t<\/video>\n\t\t\t<\/div>\n\t\t<\/span>\n\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $item->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' title='\nCONTENT;\n\n$sprintf = array($item->caption); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'view_this_image', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n' class='ipsThumb ipsThumb_embed ipsThumb_bg \nCONTENT;\n\nif ( ! \\IPS\\Settings::i()->max_internalembed_width ):\n$return .= <<<CONTENT\nipsThumb_embed_fullWidth\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n' style='background-image: url( \"\nCONTENT;\n\n$return .= str_replace( array( '(', ')' ), array( '\\(', '\\)' ), \\IPS\\File::get( 'gallery_Images', $item->masked_file_name )->url );;\n$return .= <<<CONTENT\n\" );'>\n\t\t\t<img src='\nCONTENT;\n\n$return .= \\IPS\\File::get( \"gallery_Images\", $item->masked_file_name )->url;\n$return .= <<<CONTENT\n' alt=\"\nCONTENT;\n$return .= htmlspecialchars( $item->caption, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class='ipsHide'>\n\t\t<\/a>\n\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t<div class='ipsPadding ipsClearfix'>\n\t\t\nCONTENT;\n\nif ( $desc = $item->truncated(TRUE) ):\n$return .= <<<CONTENT\n\n\t\t\t<div class='ipsType_richText ipsType_medium' data-truncate='3'>\n\t\t\t\t{$desc}\n\t\t\t<\/div>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\nif ( $item->copyright ):\n$return .= <<<CONTENT\n\n\t\t\t<p class='ipsType_reset ipsType_light ipsType_medium ipsSpacer_top ipsSpacer_half'>\n\t\t\t\t&copy; \nCONTENT;\n$return .= htmlspecialchars( $item->copyright, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t<\/p>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"embed\", \"core\" )->embedItemStats( $item );\n$return .= <<<CONTENT\n\n\t<\/div>\n\n\t\nCONTENT;\n\nif ( $item->directContainer() instanceof \\IPS\\gallery\\Album ):\n$return .= <<<CONTENT\n\n\t\t<div class='ipsAreaBackground_light ipsPadding ipsClearfix ipsRichEmbed_moreInfo'>\n\t\t\t<h3 class='ipsType_minorHeading ipsTruncate ipsTruncate_line ipsType_blendLinks'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'from_the_album', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n \"<a href='\nCONTENT;\n$return .= htmlspecialchars( $item->directContainer()->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\nCONTENT;\n$return .= htmlspecialchars( $item->directContainer()->_title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/a>\"<\/h3>\n\t\t\t\nCONTENT;\n\n$images = \\IPS\\Gallery\\Image::getItemsWithPermission( array( array( 'image_album_id=?', $item->album_id ) ), ( $item->directContainer()->sort_options == 'title' ) ? 'image_caption ASC' : $item::$databasePrefix . $item::$databaseColumnMap[ $item->directContainer()->sort_options ] . ' DESC', 9 );\n$return .= <<<CONTENT\n\n\n\t\t\t\nCONTENT;\n\nif ( \\count( $images ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t<ul class='ipsList_reset cGalleryEmbed_albumStrip cGalleryEmbed_albumStrip_mini ipsSpacer_top ipsSpacer_half'>\n\t\t\t\t\t\nCONTENT;\n\nforeach ( $images as $albumImage ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $albumImage->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' style='background-image: url( \"\nCONTENT;\n\n$return .= str_replace( array( '(', ')' ), array( '\\(', '\\)' ), \\IPS\\File::get( 'gallery_Images', $albumImage->small_file_name )->url );;\n$return .= <<<CONTENT\n\") '>\n\t\t\t\t\t\t\t\t<img src='\nCONTENT;\n\n$return .= \\IPS\\File::get( \"gallery_Images\", $albumImage->small_file_name )->url;\n$return .= <<<CONTENT\n' class='ipsHide'>\n\t\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\n\t\t\t\t\t\nCONTENT;\n\nif ( $item->directContainer()->count_imgs > 9 ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<li class='cGalleryEmbed_albumStrip_last ipsAreaBackground'>\n\t\t\t\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $item->directContainer()->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'><span>+\nCONTENT;\n\n$return .= htmlspecialchars( $item->directContainer()->count_imgs - 9, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/span><\/a>\n\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/ul>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<\/div>\n\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n<\/div>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction embedImageComment( $comment, $item, $url ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\n<div data-embedInfo-maxSize='\nCONTENT;\n\nif ( \\IPS\\Settings::i()->max_internalembed_width ):\n$return .= <<<CONTENT\n\nCONTENT;\n\n$return .= \\IPS\\Settings::i()->max_internalembed_width;\n$return .= <<<CONTENT\n\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n100%\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n' class='ipsRichEmbed'>\n\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"embed\", \"core\" )->embedHeader( $comment, $item->mapped('title'), $comment->mapped('date'), $url );\n$return .= <<<CONTENT\n\n\t<div class='ipsPadding'>\n\t\t<div class='ipsRichEmbed_originalItem ipsAreaBackground_reset ipsSpacer_bottom ipsType_blendLinks'>\n\t\t\t<div>\n\t\t\t\t\nCONTENT;\n\nif ( $item->media  ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $item->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' title='\nCONTENT;\n\n$sprintf = array($item->caption); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'view_this_video', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n' class='ipsThumb ipsNoThumb ipsNoThumb_video ipsThumb_medium'>\n\t\t\t\t\t\t<video data-role=\"video\" class=\"ipsPos_center\" preload=\"metadata\" width=\"100%\" height=\"100%\"\nCONTENT;\n\nif ( $item->masked_file_name  ):\n$return .= <<<CONTENT\n poster=\"\nCONTENT;\n\n$return .= \\IPS\\File::get( \"gallery_Images\", $item->masked_file_name )->url;\n$return .= <<<CONTENT\n\"\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n>\n\t\t\t\t\t\t\t<source src=\"\nCONTENT;\n\n$return .= \\IPS\\File::get( \"gallery_Images\", $item->original_file_name )->url;\n$return .= <<<CONTENT\n\" type='\nCONTENT;\n$return .= htmlspecialchars( $item->file_type, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' \/>\n\t\t\t\t\t\t<\/video>\n\t\t\t\t\t<\/a>\n\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t<div class='ipsRichEmbed_masthead ipsRichEmbed_mastheadBg cGalleryEmbed_imageComment ipsType_center'>\n\t\t\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $item->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' title='\nCONTENT;\n\n$sprintf = array($item->caption); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'view_this_image', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n' class='ipsThumb ipsThumb_medium ipsThumb_bg' style='background-image: url( \"\nCONTENT;\n\n$return .= str_replace( array( '(', ')' ), array( '\\(', '\\)' ), \\IPS\\File::get( 'gallery_Images', $item->small_file_name )->url );;\n$return .= <<<CONTENT\n\" );'>\n\t\t\t\t\t\t\t<img src='\nCONTENT;\n\n$return .= \\IPS\\File::get( \"gallery_Images\", $item->small_file_name )->url;\n$return .= <<<CONTENT\n' alt=\"\nCONTENT;\n$return .= htmlspecialchars( $item->caption, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class='ipsHide'>\n\t\t\t\t\t\t<\/a>\n\t\t\t\t\t<\/div>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\n\t\t\t\t<div class='ipsPadding'>\n\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"embed\", \"core\" )->embedOriginalItem( $item );\n$return .= <<<CONTENT\n\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t<\/div>\n\n\t\t<div class='ipsType_richText ipsType_medium' data-truncate='3'>\n\t\t\t{$comment->truncated(TRUE)}\n\t\t<\/div>\n\n\t\t\nCONTENT;\n\nif ( \\IPS\\Settings::i()->reputation_enabled and \\IPS\\IPS::classUsesTrait( $comment, 'IPS\\Content\\Reactable' ) and \\count( $comment->reactions() ) ):\n$return .= <<<CONTENT\n\n\t\t\t<ul class='ipsList_inline ipsSpacer_top ipsSpacer_half'>\n\t\t\t\t<li>\n\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\" )->reactionOverview( $comment, TRUE, 'small' );\n$return .= <<<CONTENT\n\n\t\t\t\t<\/li>\n\t\t\t<\/ul>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t<\/div>\n<\/div>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction embedImageReview( $comment, $item, $url ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\n<div data-embedInfo-maxSize='\nCONTENT;\n\nif ( \\IPS\\Settings::i()->max_internalembed_width ):\n$return .= <<<CONTENT\n\nCONTENT;\n\n$return .= \\IPS\\Settings::i()->max_internalembed_width;\n$return .= <<<CONTENT\n\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n100%\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n' class='ipsRichEmbed'>\n\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"embed\", \"core\" )->embedHeader( $comment, $item->mapped('title'), $comment->mapped('date'), $url );\n$return .= <<<CONTENT\n\n\t<div class='ipsPadding'>\n\t\t<div class='ipsRichEmbed_originalItem ipsAreaBackground_reset ipsSpacer_bottom ipsType_blendLinks'>\n\t\t\t<div>\n\t\t\t\t\nCONTENT;\n\nif ( $item->media  ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $item->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' title='\nCONTENT;\n\n$sprintf = array($item->caption); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'view_this_video', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n' class='ipsThumb ipsNoThumb ipsNoThumb_video ipsThumb_medium'>\n\t\t\t\t\t\t<video data-role=\"video\" class=\"ipsPos_center\" preload=\"metadata\" width=\"100%\" height=\"100%\"\nCONTENT;\n\nif ( $item->masked_file_name  ):\n$return .= <<<CONTENT\n poster=\"\nCONTENT;\n\n$return .= \\IPS\\File::get( \"gallery_Images\", $item->masked_file_name )->url;\n$return .= <<<CONTENT\n\"\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n>\n\t\t\t\t\t\t\t<source src=\"\nCONTENT;\n\n$return .= \\IPS\\File::get( \"gallery_Images\", $item->original_file_name )->url;\n$return .= <<<CONTENT\n\" type='\nCONTENT;\n$return .= htmlspecialchars( $item->file_type, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' \/>\n\t\t\t\t\t\t<\/video>\n\t\t\t\t\t<\/a>\n\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t<div class='ipsRichEmbed_masthead ipsRichEmbed_mastheadBg cGalleryEmbed_imageComment ipsType_center'>\n\t\t\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $item->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' title='\nCONTENT;\n\n$sprintf = array($item->caption); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'view_this_image', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n' class='ipsThumb ipsThumb_medium ipsThumb_bg' style='background-image: url( \"\nCONTENT;\n\n$return .= str_replace( array( '(', ')' ), array( '\\(', '\\)' ), \\IPS\\File::get( 'gallery_Images', $item->small_file_name )->url );;\n$return .= <<<CONTENT\n\" );'>\n\t\t\t\t\t\t\t<img src='\nCONTENT;\n\n$return .= \\IPS\\File::get( \"gallery_Images\", $item->small_file_name )->url;\n$return .= <<<CONTENT\n' alt=\"\nCONTENT;\n$return .= htmlspecialchars( $item->caption, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class='ipsHide'>\n\t\t\t\t\t\t<\/a>\n\t\t\t\t\t<\/div>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<div class='ipsPadding'>\n\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"embed\", \"core\" )->embedOriginalItem( $item );\n$return .= <<<CONTENT\n\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t<\/div>\n\n\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\" )->rating( 'veryLarge', $comment->mapped('rating') );\n$return .= <<<CONTENT\n \n\t\t\nCONTENT;\n\nif ( $comment->mapped('votes_total') ):\n$return .= <<<CONTENT\n\n\t\t\t<p class='ipsType_reset ipsType_medium'>{$comment->helpfulLine()}<\/p>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<hr class='ipsHr'>\n\t\t<div class='ipsType_richText ipsType_medium ipsSpacer_top ipsSpacer_half' data-truncate='3'>\n\t\t\t{$comment->truncated(TRUE)}\n\t\t<\/div>\n\n\t\t\nCONTENT;\n\nif ( \\IPS\\Settings::i()->reputation_enabled and \\IPS\\IPS::classUsesTrait( $comment, 'IPS\\Content\\Reactable' ) and \\count( $comment->reactions() ) ):\n$return .= <<<CONTENT\n\n\t\t\t<ul class='ipsList_inline ipsSpacer_top ipsSpacer_half'>\n\t\t\t\t<li>\n\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\" )->reactionOverview( $comment, TRUE, 'small' );\n$return .= <<<CONTENT\n\n\t\t\t\t<\/li>\n\t\t\t<\/ul>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t<\/div>\n<\/div>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction featuredComment( $comment, $id, $commentLang='__defart_comment' ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\nCONTENT;\n\nif ( isset( $comment['comment'] ) ):\n$return .= <<<CONTENT\n\n\t\nCONTENT;\n\n$idField = $comment['comment']::$databaseColumnId;\n$return .= <<<CONTENT\n\n\t<div class='ipsBox ipsBox--child ipsPadding ipsClearfix ipsComment_recommended ipsSpacer_bottom' data-commentID='\nCONTENT;\n$return .= htmlspecialchars( $id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\n\t\t\nCONTENT;\n\nif ( \\IPS\\IPS::classUsesTrait( $comment['comment'], 'IPS\\Content\\Reactable' ) and \\IPS\\Settings::i()->reputation_enabled ):\n$return .= <<<CONTENT\n\n\t\t\t<div class='ipsPos_right'>\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\" )->reactionOverview( $comment['comment'] );\n$return .= <<<CONTENT\n<\/div>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<span class='ipsComment_recommendedFlag'><i class='fa fa-star'><\/i><span class='ipsResponsive_hidePhone'> \nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'recommended', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/span><\/span>\n\t\t<div class='ipsComment_header ipsPhotoPanel ipsPhotoPanel_mini ipsSpacer_top'>\n\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\" )->userPhoto( $comment['comment']->author(), 'mini', $comment['comment']->warningRef() );\n$return .= <<<CONTENT\n\n\t\t\t<div>\n\t\t\t\t<h3 class='ipsComment_author ipsType_blendLinks'>\n\t\t\t\t\t<strong class='ipsType_normal'>\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\" )->userLink( $comment['comment']->author(), $comment['comment']->warningRef() );\n$return .= <<<CONTENT\n<\/strong>\n\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\" )->reputationBadge( $comment['comment']->author() );\n$return .= <<<CONTENT\n\n\t\t\t\t<\/h3>\n\t\t\t\t<p class='ipsComment_meta ipsType_light ipsType_small'>\n\t\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $comment['comment']->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' class='ipsType_blendLinks'>{$comment['comment']->dateLine()}<\/a>\n\t\t\t\t\t\nCONTENT;\n\nif ( $comment['comment']->editLine() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t(\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'edited_lc', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n)\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/p>\n\t\t\t<\/div>\n\t\t<\/div>\n\n\t\t<div class='ipsType_richText ipsType_normal' data-ipsTruncate data-ipsTruncate-type='remove' data-ipsTruncate-size='2 lines'>{$comment['comment']->truncated( TRUE )}<\/div>\n\n\t\t\nCONTENT;\n\nif ( $comment['note'] ):\n$return .= <<<CONTENT\n\n\t\t\t<div class='ipsComment_recommendedNote ipsType_medium'>\n\t\t\t\t<p class='ipsType_reset ipsType_richText'>\nCONTENT;\n$return .= htmlspecialchars( $comment['note'], ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/p>\n\t\t\t\t\nCONTENT;\n\nif ( isset( $comment['featured_by'] ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<p class='ipsType_reset ipsType_light'>\nCONTENT;\n\n$htmlsprintf = array($comment['featured_by']->link()); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'recommended_by', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'htmlsprintf' => $htmlsprintf ) );\n$return .= <<<CONTENT\n<\/p>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t<\/div>\n\t\t\nCONTENT;\n\nelseif ( isset( $comment['featured_by'] ) ):\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\n$htmlsprintf = array($comment['featured_by']->link()); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'recommended_by', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'htmlsprintf' => $htmlsprintf ) );\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\n\t\t<hr class='ipsHr'>\n\t\t<div>\n\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $comment['comment']->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-action='goToComment' class='ipsButton ipsButton_link ipsButton_verySmall ipsButton_fullWidth'>\nCONTENT;\n\n$sprintf = array(\\IPS\\Member::loggedIn()->language()->get( $commentLang )); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'go_to_this_comment', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n <i class='fa fa-angle-right'><\/i><\/a>\n\t\t<\/div>\n\t<\/div>\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction featuredComments( $comments, $url, $titleLang='recommended_replies', $commentLang='__defart_comment' ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\n<div data-controller='core.front.core.recommendedComments' data-url='\nCONTENT;\n$return .= htmlspecialchars( $url, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' class='ipsAreaBackground ipsPad ipsBox ipsBox_transparent ipsSpacer_bottom ipsRecommendedComments \nCONTENT;\n\nif ( !\\count( $comments ) ):\n$return .= <<<CONTENT\nipsHide\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n'>\n\t<div data-role=\"recommendedComments\">\n\t\t<h2 class='ipsType_sectionHead ipsType_large'>\nCONTENT;\n\n$val = \"{$titleLang}\"; $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( $val, ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h2>\n\t\t\nCONTENT;\n\nif ( \\count( $comments ) ):\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\nforeach ( $comments AS $id => $comment ):\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"gallery\" )->featuredComment( $comment, $id, $commentLang );\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t<\/div>\n<\/div>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction manageFollowNodeRow( $table, $headers, $rows ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\nCONTENT;\n\nforeach ( $rows as $row ):\n$return .= <<<CONTENT\n\n\t\nCONTENT;\n\n$contentItemClass = $row::$contentItemClass;\n$return .= <<<CONTENT\n\n\t<li class=\"ipsDataItem \nCONTENT;\n\nif ( $contentItemClass::containerUnread( $row ) ):\n$return .= <<<CONTENT\nipsDataItem_unread\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n \nCONTENT;\n\nif ( method_exists( $row, 'tableClass' ) && $row->tableClass() ):\n$return .= <<<CONTENT\nipsDataItem_\nCONTENT;\n$return .= htmlspecialchars( $row->tableClass(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\" data-controller='core.front.system.manageFollowed' data-followID='\nCONTENT;\n$return .= htmlspecialchars( $row->_followData['follow_area'], ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n-\nCONTENT;\n$return .= htmlspecialchars( $row->_followData['follow_rel_id'], ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\n\t\t<div class='ipsDataItem_generic ipsDataItem_size3'>\n\t\t\t\nCONTENT;\n\nif ( $coverImage = $row->coverPhoto('small')  ):\n$return .= <<<CONTENT\n\n\t\t\t\t<span class='ipsThumb_bg ipsThumb_small ipsPos_left' style='background-image: url(\"\nCONTENT;\n\n$return .= str_replace( array( '(', ')' ), array( '\\(', '\\)' ), $coverImage );;\n$return .= <<<CONTENT\n\")'>\n\t\t\t\t\t<img src='\nCONTENT;\n$return .= htmlspecialchars( $coverImage, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' alt=\"\nCONTENT;\n$return .= htmlspecialchars( $row->_title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class=\"\">\n\t\t\t\t<\/span>\n\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t<span class='ipsNoThumb ipsThumb_small ipsPos_left'><\/span>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<\/div>\n\t\t<div class='ipsDataItem_main'>\n\t\t\t<h4 class='ipsType_sectionHead'>\n\t\t\t\t\nCONTENT;\n\nif ( $row->_locked ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<i class=\"fa fa-lock\"><\/i>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\n\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $row->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\n\t\t\t\t\t\nCONTENT;\n$return .= htmlspecialchars( $row->_title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t<\/a>\n\t\t\t<\/h4>\n\t\t\t<div class='ipsDataItem_meta ipsType_light' data-ipsTruncate data-ipsTruncate-size='2 lines' data-ipsTruncate-type='remove'>\n\t\t\t\t\nCONTENT;\n$return .= htmlspecialchars( $row->_description, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t<\/div>\n\t\t\t<ul class='ipsList_inline ipsType_light'>\n\t\t\t\t\nCONTENT;\n\nif ( $row->_items ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li>\nCONTENT;\n\n$pluralize = array( $row->_items ); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'node_content_items', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'pluralize' => $pluralize ) );\n$return .= <<<CONTENT\n<\/li>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nif ( $row->_commentsForDisplay ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li>\nCONTENT;\n\n$pluralize = array( $row->_commentsForDisplay ); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'node_content_comments', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'pluralize' => $pluralize ) );\n$return .= <<<CONTENT\n<\/li>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nif ( $row->_reviews ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li>\nCONTENT;\n\n$pluralize = array( $row->_reviews ); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'node_content_reviews', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'pluralize' => $pluralize ) );\n$return .= <<<CONTENT\n<\/li>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t<\/ul>\n\n\t\t\t\nCONTENT;\n\nif ( \\count( $row->_latestImages ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t<ul class='ipsList_inline cGalleryManagedAlbumThumbs'>\n\t\t\t\t\t\nCONTENT;\n\nforeach ( \\array_slice( iterator_to_array( $row->_latestImages ), 0, 10, true ) as $image  ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $image->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\n\t\t\t\t\t\t\t\t<span class='ipsThumb_bg ipsThumb_small ipsPos_left' style='background-image: url(\"\nCONTENT;\n\n$return .= str_replace( array( '(', ')' ), array( '\\(', '\\)' ), \\IPS\\File::get( 'gallery_Images', $image->small_file_name )->url );;\n$return .= <<<CONTENT\n\")'>\n\t\t\t\t\t\t\t\t\t<img src='\nCONTENT;\n\n$return .= \\IPS\\File::get( \"gallery_Images\", $image->small_file_name )->url;\n$return .= <<<CONTENT\n' alt=\"\nCONTENT;\n$return .= htmlspecialchars( $image->caption, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class=\"\">\n\t\t\t\t\t\t\t\t<\/span>\n\t\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/ul>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<\/div>\n\t\t\n\t\t<div class='ipsDataItem_generic ipsDataItem_size1 ipsType_center ipsType_large'>\n\t\t\t<span class='ipsBadge ipsBadge_icon ipsBadge_new \nCONTENT;\n\nif ( !$row->_followData['follow_is_anon'] ):\n$return .= <<<CONTENT\nipsHide\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n' data-role='followAnonymous' data-ipsTooltip title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'follow_is_anon', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n'><i class='fa fa-eye-slash'><\/i><\/span>\n\t\t<\/div>\n\n\t\t<div class='ipsDataItem_generic ipsDataItem_size6'>\n\t\t\t<ul class='ipsList_reset'>\n\t\t\t\t<li title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'follow_when', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n' data-role='followDate'><i class='fa fa-clock-o'><\/i> \nCONTENT;\n\n$val = ( $row->_followData['follow_added'] instanceof \\IPS\\DateTime ) ? $row->_followData['follow_added'] : \\IPS\\DateTime::ts( $row->_followData['follow_added'] );$return .= $val->html();\n$return .= <<<CONTENT\n<\/li>\n\t\t\t\t<li title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'follow_how', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n' data-role='followFrequency'>\n\t\t\t\t\t\nCONTENT;\n\nif ( $row->_followData['follow_notify_freq'] == 'none' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<i class='fa fa-bell-slash-o'><\/i>\n\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<i class='fa fa-bell'><\/i>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n \nCONTENT;\n\n$val = \"follow_freq_{$row->_followData['follow_notify_freq']}\"; $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( $val, ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t\t\t<\/li>\n\t\t\t<\/ul>\n\t\t<\/div>\n\n\t\t<div class='ipsDataItem_generic ipsDataItem_size6 ipsType_center'>\n\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"system\", \"core\" )->manageFollow( $row->_followData['follow_app'], $row->_followData['follow_area'], $row->_followData['follow_rel_id'] );\n$return .= <<<CONTENT\n\n\t\t<\/div>\n\n\t\t\nCONTENT;\n\nif ( $table->canModerate() ):\n$return .= <<<CONTENT\n\n\t\t\t<div class='ipsDataItem_modCheck'>\n\t\t\t\t<span class='ipsCustomInput'>\n\t\t\t\t\t<input type='checkbox' data-role='moderation' name=\"moderate[\nCONTENT;\n$return .= htmlspecialchars( $row->_id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n]\" data-actions=\"\nCONTENT;\n\n$return .= htmlspecialchars( implode( ' ', $table->multimodActions( $row ) ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" data-state=''>\n\t\t\t\t\t<span><\/span>\n\t\t\t\t<\/span>\n\t\t\t<\/div>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t<\/li>\n\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction manageFollowRow( $table, $headers, $rows, $includeFirstCommentInCommentCount=TRUE ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\nCONTENT;\n\nif ( \\count( $rows ) ):\n$return .= <<<CONTENT\n\n\t\nCONTENT;\n\nforeach ( $rows as $row ):\n$return .= <<<CONTENT\n\n\t\nCONTENT;\n\n$idField = $row::$databaseColumnId;\n$return .= <<<CONTENT\n\n\t\t<li class=\"ipsDataItem ipsDataItem_responsivePhoto \nCONTENT;\n\nif ( $row->unread() ):\n$return .= <<<CONTENT\nipsDataItem_unread\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n \nCONTENT;\n\nif ( method_exists( $row, 'tableClass' ) && $row->tableClass() ):\n$return .= <<<CONTENT\nipsDataItem_\nCONTENT;\n$return .= htmlspecialchars( $row->tableClass(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n \nCONTENT;\n\nif ( $row->hidden() ):\n$return .= <<<CONTENT\nipsModerated\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\" data-controller='core.front.system.manageFollowed' data-followID='\nCONTENT;\n$return .= htmlspecialchars( $row->_followData['follow_area'], ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n-\nCONTENT;\n$return .= htmlspecialchars( $row->_followData['follow_rel_id'], ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\n\t\t\t<div class='ipsDataItem_generic ipsDataItem_size2 ipsDataItem_imageColumn'>\n\t\t\t\t<div class='ipsThumb ipsThumb_bg ipsThumb_small' style='background-image: url( \nCONTENT;\n\n$return .= str_replace( array( '(', ')' ), array( '\\(', '\\)' ), \\IPS\\File::get( 'gallery_Images', $row->small_file_name )->url );;\n$return .= <<<CONTENT\n )'><\/div>\n\t\t\t<\/div>\n\t\t\t<div class='ipsDataItem_main ipsPos_middle'>\n\t\t\t\t<h4 class='ipsDataItem_title ipsContained_container'>\n\t\t\t\t\t\nCONTENT;\n\nif ( $row->mapped('locked') ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<span><i class=\"fa fa-lock\"><\/i><\/span>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\n\t\t\t\t\t\nCONTENT;\n\nif ( $row->mapped('pinned') || $row->mapped('featured') || $row->hidden() === -1 || $row->hidden() === 1 ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $row->hidden() === -1 ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<span class=\"ipsBadge ipsBadge_icon ipsBadge_small ipsBadge_warning\" data-ipsTooltip title='\nCONTENT;\n$return .= htmlspecialchars( $row->hiddenBlurb(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'><i class='fa fa-eye-slash'><\/i><\/span>\n\t\t\t\t\t\t\t\nCONTENT;\n\nelseif ( $row->hidden() === 1 ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<span class=\"ipsBadge ipsBadge_icon ipsBadge_small ipsBadge_warning\" data-ipsTooltip title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'pending_approval', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n'><i class='fa fa-warning'><\/i><\/span>\n\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $row->mapped('pinned') ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<span class=\"ipsBadge ipsBadge_icon ipsBadge_small ipsBadge_positive\" data-ipsTooltip title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'pinned', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n'><i class='fa fa-thumb-tack'><\/i><\/span>\n\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $row->mapped('featured') ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<span class=\"ipsBadge ipsBadge_icon ipsBadge_small ipsBadge_positive\" data-ipsTooltip title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'featured', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n'><i class='fa fa-star'><\/i><\/span>\n\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<\/span>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\n\t\t\t\t\t\nCONTENT;\n\nif ( $row->prefix() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<span>\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\" )->prefix( $row->prefix( TRUE ), $row->prefix() );\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\n\t\t\t\t\t<span class='ipsContained ipsType_break'>\n\t\t\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $row->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\n\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $row->mapped('title') ):\n$return .= <<<CONTENT\n\nCONTENT;\n$return .= htmlspecialchars( $row->mapped('title'), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n<em class=\"ipsType_light\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'content_deleted', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/em>\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<\/a>\n\t\t\t\t\t<\/span>\n\t\t\t\t<\/h4>\n\t\t\t\t<div class='ipsDataItem_meta ipsType_light ipsType_blendLinks' data-ipsTruncate data-ipsTruncate-size='2 lines' data-ipsTruncate-type='remove'>\n\t\t\t\t\t\nCONTENT;\n\nif ( method_exists( $row, 'tableDescription' ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t{$row->tableDescription()}\n\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n                        \nCONTENT;\n\n$htmlsprintf = array($row->author()->link( $row->warningRef() )); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'byline', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'htmlsprintf' => $htmlsprintf ) );\n$return .= <<<CONTENT\n\nCONTENT;\n\n$val = ( $row->__get( $row::$databaseColumnMap['date'] ) instanceof \\IPS\\DateTime ) ? $row->__get( $row::$databaseColumnMap['date'] ) : \\IPS\\DateTime::ts( $row->__get( $row::$databaseColumnMap['date'] ) );$return .= $val->html();\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'in', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n <a href=\"\nCONTENT;\n$return .= htmlspecialchars( $row->container()->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\nCONTENT;\n$return .= htmlspecialchars( $row->container()->_title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/div>\t\t\t\t\n\t\t\t<\/div>\n\n\t\t\t<div class='ipsDataItem_generic ipsDataItem_size1 ipsType_center ipsType_large cFollowedContent_anon'>\n\t\t\t\t<span class='ipsBadge ipsBadge_icon ipsBadge_new \nCONTENT;\n\nif ( !$row->_followData['follow_is_anon'] ):\n$return .= <<<CONTENT\nipsHide\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n' data-role='followAnonymous' data-ipsTooltip title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'follow_is_anon', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n'><i class='fa fa-eye-slash'><\/i><\/span>\n\t\t\t<\/div>\n\n\t\t\t<div class='ipsDataItem_generic ipsDataItem_size6 cFollowedContent_info'>\n\t\t\t\t<ul class='ipsList_reset'>\n\t\t\t\t\t<li title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'follow_when', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n' data-role='followDate'><i class='fa fa-clock-o'><\/i> \nCONTENT;\n\n$val = ( $row->_followData['follow_added'] instanceof \\IPS\\DateTime ) ? $row->_followData['follow_added'] : \\IPS\\DateTime::ts( $row->_followData['follow_added'] );$return .= $val->html();\n$return .= <<<CONTENT\n<\/li>\n\t\t\t\t\t<li title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'follow_how', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n' data-role='followFrequency'>\n\t\t\t\t\t\t\nCONTENT;\n\nif ( $row->_followData['follow_notify_freq'] == 'none' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<i class='fa fa-bell-slash-o'><\/i>\n\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<i class='fa fa-bell'><\/i>\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n \nCONTENT;\n\n$val = \"follow_freq_{$row->_followData['follow_notify_freq']}\"; $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( $val, ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t<\/li>\n\t\t\t\t<\/ul>\n\t\t\t<\/div>\n\n\t\t\t<div class='ipsDataItem_generic ipsDataItem_size6 ipsType_center cFollowedContent_manage'>\n\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"system\", \"core\" )->manageFollow( $row->_followData['follow_app'], $row->_followData['follow_area'], $row->_followData['follow_rel_id'] );\n$return .= <<<CONTENT\n\n\t\t\t<\/div>\n\n\t\t\t\nCONTENT;\n\nif ( $table->canModerate() ):\n$return .= <<<CONTENT\n\n\t\t\t\t<div class='ipsDataItem_modCheck'>\n\t\t\t\t\t<span class='ipsCustomInput'>\n\t\t\t\t\t\t<input type='checkbox' data-role='moderation' name=\"moderate[\nCONTENT;\n$return .= htmlspecialchars( $row->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n]\" data-actions=\"\nCONTENT;\n\n$return .= htmlspecialchars( implode( ' ', $table->multimodActions( $row ) ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" data-state='\nCONTENT;\n\nif ( $row->tableStates() ):\n$return .= <<<CONTENT\n\nCONTENT;\n$return .= htmlspecialchars( $row->tableStates(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n'>\n\t\t\t\t\t\t<span><\/span>\n\t\t\t\t\t<\/span>\n\t\t\t\t<\/div>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\n\t\t<\/li>\n\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction profileAlbumTable( $table, $headers, $rows, $quickSearch ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\n<div data-baseurl='\nCONTENT;\n$return .= htmlspecialchars( $table->baseUrl, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-resort='\nCONTENT;\n$return .= htmlspecialchars( $table->resortKey, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-pageParam='albumPage' data-controller='core.global.core.table\nCONTENT;\n\nif ( $table->canModerate() ):\n$return .= <<<CONTENT\n,core.front.core.moderation\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n'>\n\t<div data-role=\"tablePagination\" class='ipsSpacer_bottom \nCONTENT;\n\nif ( $table->pages <= 1 ):\n$return .= <<<CONTENT\nipsHide\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n'>\n\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\", 'global' )->pagination( $table->baseUrl, $table->pages, $table->page, $table->limit, TRUE, 'albumPage' );\n$return .= <<<CONTENT\n\n\t<\/div>\n\n\t<ol class='ipsList_reset ipsClear ipsGrid ipsGrid_collapsePhone' data-role='tableRows' data-controller='gallery.front.browse.list' id='elTable_\nCONTENT;\n$return .= htmlspecialchars( $table->uniqueId, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\n\t\t\nCONTENT;\n\n$return .= $table->rowsTemplate[0]->{$table->rowsTemplate[1]}( $table, $headers, $rows );\n$return .= <<<CONTENT\n\n\t<\/ol>\n<\/div>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction review( $item, $review, $editorName, $app, $type ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n<div id='review-\nCONTENT;\n$return .= htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_wrap' data-controller='core.front.core.comment' data-commentApp='\nCONTENT;\n$return .= htmlspecialchars( $app, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-commentType='\nCONTENT;\n$return .= htmlspecialchars( $type, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n-review' data-commentID=\"\nCONTENT;\n$return .= htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" data-quoteData='\nCONTENT;\n\n$return .= htmlspecialchars( json_encode( array('userid' => $review->author()->member_id, 'username' => $review->author()->name, 'timestamp' => $review->mapped('date'), 'contentapp' => $app, 'contenttype' => $type, 'contentid' => $item->id, 'contentcommentid' => $review->id) ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' class='ipsComment_content ipsType_medium'>\n\t<div class='ipsComment_header ipsFlex ipsFlex-ai:start ipsFlex-jc:between'>\n\t\t<div class='ipsPhotoPanel ipsPhotoPanel_small'>\n\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\" )->userPhoto( $review->author(), 'small', $review->warningRef(), 'ipsPos_left' );\n$return .= <<<CONTENT\n\n\t\t\t<div>\n\t\t\t\t<h3 class=\"ipsComment_author ipsType_blendLinks\">\n\t\t\t\t\t<strong class='ipsType_normal'>\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\" )->userLink( $review->author(), $review->warningRef() );\n$return .= <<<CONTENT\n<\/strong>\n\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\" )->reputationBadge( $review->author() );\n$return .= <<<CONTENT\n\n\t\t\t\t<\/h3>\n\t\t\t\t<p class=\"ipsComment_meta ipsType_medium ipsType_light\">\n\t\t\t\t\t\nCONTENT;\n\nif ( $review->mapped('date') ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n\n$val = ( $review->mapped('date') instanceof \\IPS\\DateTime ) ? $review->mapped('date') : \\IPS\\DateTime::ts( $review->mapped('date') );$return .= $val->html();\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'unknown_date', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\n\t\t\t\t\t\nCONTENT;\n\nif ( $review->editLine() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t&middot; {$review->editLine()}\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nif ( $review->hidden() AND $review->hidden() != -2 ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t&middot; \nCONTENT;\n$return .= htmlspecialchars( $review->hiddenBlurb(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nelseif ( $review->hidden() == -2 ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t&middot; \nCONTENT;\n$return .= htmlspecialchars( $review->deletedBlurb(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/p>\n\t\t\t\t<ul class='ipsList_inline ipsClearfix ipsRating ipsRating_large'>\n\t\t\t\t\t\nCONTENT;\n\nforeach ( range( 1, \\intval( \\IPS\\Settings::i()->reviews_rating_out_of ) ) as $i ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<li class='\nCONTENT;\n\nif ( $review->mapped('rating') >= $i ):\n$return .= <<<CONTENT\nipsRating_on\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\nipsRating_off\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n'>\n\t\t\t\t\t\t\t<i class='fa fa-star'><\/i>\n\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/ul>&nbsp;&nbsp; \nCONTENT;\n\nif ( $review->mapped('votes_total') ):\n$return .= <<<CONTENT\n<strong class='ipsType_medium'>{$review->helpfulLine()}<\/strong><br>\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t<\/div>\n\t\t<\/div>\n\t\t<div class='ipsType_reset ipsType_light ipsType_blendLinks ipsComment_toolWrap'>\n\t\t\t<ul class='ipsList_reset ipsComment_tools'>\n\t\t\t\t<li>\n\t\t\t\t\t<a href='#elControlsReviews_\nCONTENT;\n$return .= htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_menu' class='ipsComment_ellipsis' id='elControlsReviews_\nCONTENT;\n$return .= htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'more_options', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n' data-ipsMenu data-ipsMenu-appendTo='#review-\nCONTENT;\n$return .= htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_wrap'><i class='fa fa-ellipsis-h'><\/i><\/a>\n\t\t\t\t\t<ul id='elControlsReviews_\nCONTENT;\n$return .= htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_menu' class='ipsMenu ipsMenu_narrow ipsHide'>\n\t\t\t\t\t\t\nCONTENT;\n\nif ( $review->canReportOrRevoke() === TRUE ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<li class='ipsMenu_item'>\n\t\t\t\t\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $review->url('report'), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' \nCONTENT;\n\nif ( \\IPS\\Member::loggedIn()->member_id or \\IPS\\Helpers\\Form\\Captcha::supportsModal() ):\n$return .= <<<CONTENT\ndata-ipsDialog data-ipsDialog-remoteSubmit data-ipsDialog-size='medium' data-ipsDialog-flashMessage='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'report_submit_success', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n' data-ipsDialog-title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'report', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\"\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n data-action='reportComment' title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'report', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'report', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<li class='ipsMenu_item'>\n\t\t\t\t\t\t\t<a class='ipsType_blendLinks' href='\nCONTENT;\n$return .= htmlspecialchars( $review->item()->url()->setQueryString( array( 'do' => 'findReview', 'review' => $review->id ) ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'share_this_review', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n' data-ipsDialog data-ipsDialog-size='narrow' data-ipsDialog-content='#elShareReview_\nCONTENT;\n$return .= htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_menu' data-ipsDialog-title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'share_this_review', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\"  id='elShareReview_\nCONTENT;\n$return .= htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-role='shareComment'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'share_this_review', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\t<\/li>\n\n\t\t\t\t\t\t\nCONTENT;\n\nif ( $review->canEdit() || ( $review->hidden() == -2 AND \\IPS\\Member::loggedIn()->modPermission('can_manage_deleted_content') ) || ( $review instanceof \\IPS\\Content\\Hideable && ( ( !$review->hidden() and $review->canHide() ) || ( $review->hidden() and $review->canUnhide() ) ) ) || $review->canDelete() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<li class='ipsMenu_sep'><hr><\/li>\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\n\t\t\t\t\t\t\nCONTENT;\n\nif ( $review->canEdit() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nCONTENT;\n$return .= htmlspecialchars( $review->url('edit'), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-action='editComment'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'edit', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\n\t\t\t\t\t\t\nCONTENT;\n\nif ( $review->hidden() == -2 AND \\IPS\\Member::loggedIn()->modPermission('can_manage_deleted_content') ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nCONTENT;\n$return .= htmlspecialchars( $review->url('restore')->csrf(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-confirm data-confirmSubMessage='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'restore_as_visible_desc', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'restore_as_visible', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nCONTENT;\n$return .= htmlspecialchars( $review->url('restore')->csrf()->setQueryString( 'restoreAsHidden', 1 ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-confirm data-confirmSubMessage='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'restore_as_hidden_desc', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'restore_as_hidden', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nCONTENT;\n$return .= htmlspecialchars( $review->url('delete')->csrf()->setQueryString( 'immediately', 1 ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-confirm data-confirmSubMessage='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'delete_immediately_desc', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'delete_immediately', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $review instanceof \\IPS\\Content\\Hideable ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( !$review->hidden() and $review->canHide() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nCONTENT;\n$return .= htmlspecialchars( $review->url('hide'), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-ipsDialog data-ipsDialog-title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'hide', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'hide', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nelseif ( $review->hidden() and $review->canUnhide() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nCONTENT;\n$return .= htmlspecialchars( $review->url('unhide')->csrf(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'unhide', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $review->canDelete() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nCONTENT;\n$return .= htmlspecialchars( $review->url('delete')->csrf()->setPage('page',\\IPS\\Request::i()->page), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-action='deleteComment' data-updateOnDelete=\"#reviewCount\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'delete', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t<\/ul>\n\t\t\t\t<\/li>\n\t\t\t\t\nCONTENT;\n\nif ( \\count( $item->reviewMultimodActions() ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<span class='ipsCustomInput'>\n\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"multimod[\nCONTENT;\n$return .= htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n]\" value=\"1\" data-role=\"moderation\" data-actions=\"\nCONTENT;\n\nif ( $review->hidden() === -1 AND $review->canUnhide() ):\n$return .= <<<CONTENT\nunhide\nCONTENT;\n\nelseif ( $review->hidden() === 1 AND $review->canUnhide() ):\n$return .= <<<CONTENT\napprove\nCONTENT;\n\nelseif ( $review->canHide() ):\n$return .= <<<CONTENT\nhide\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n \nCONTENT;\n\nif ( $review->canDelete() ):\n$return .= <<<CONTENT\ndelete\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\" data-state='\nCONTENT;\n\nif ( $review->tableStates() ):\n$return .= <<<CONTENT\n\nCONTENT;\n$return .= htmlspecialchars( $review->tableStates(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n'>\n\t\t\t\t\t\t\t<span><\/span>\n\t\t\t\t\t\t<\/span>\n\t\t\t\t\t<\/li>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t<\/ul>\n\t\t<\/div>\n\t<\/div>\n\t<div class='ipsPadding_vertical sm:ipsPadding_vertical:half ipsPadding_horizontal'>\n\t\t<div id=\"review-\nCONTENT;\n$return .= htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" data-role=\"commentContent\" class=\"ipsType_richText ipsType_normal ipsContained\" data-controller='core.front.core.lightboxedImages'>\n\t\t\t{$review->content()}\n\t\t<\/div>\n\n\t\t\nCONTENT;\n\nif ( $review->hidden() !== 1 ):\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\nif ( \\IPS\\Member::loggedIn()->member_id and ( !$review->mapped('votes_data') or !array_key_exists( \\IPS\\Member::loggedIn()->member_id, json_decode( $review->mapped('votes_data'), TRUE ) ) ) and $review->author()->member_id != \\IPS\\Member::loggedIn()->member_id ):\n$return .= <<<CONTENT\n\n\t\t\t\t<div class='ipsMargin_top'><span class='ipsType_small'><strong>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'did_you_find_this_helpful', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/strong> &nbsp;&nbsp;&nbsp;<a href='\nCONTENT;\n$return .= htmlspecialchars( $review->url('rate')->setQueryString( 'helpful', TRUE )->csrf(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' class='ipsButton ipsButton_veryVerySmall ipsButton_light' data-action=\"rateReview\"><i class='fa fa-check'><\/i> \nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'yes', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a> <a href='\nCONTENT;\n$return .= htmlspecialchars( $review->url('rate')->setQueryString( 'helpful', FALSE )->csrf(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' class='ipsButton ipsButton_veryVerySmall ipsButton_light' data-action=\"rateReview\"><i class='fa fa-times'><\/i> \nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'no', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/span><\/div>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t<\/div>\n\t\nCONTENT;\n\nif ( ( \\IPS\\Member::loggedIn()->member_id and ( !$review->mapped('votes_data') or !array_key_exists( \\IPS\\Member::loggedIn()->member_id, json_decode( $review->mapped('votes_data'), TRUE ) ) ) ) || $review->canEdit() || $review->canDelete() || $review->canHide() || $review->canUnhide() || ( $review->hidden() !== 1 && \\IPS\\IPS::classUsesTrait( $review, 'IPS\\Content\\Reactable' ) and \\IPS\\Settings::i()->reputation_enabled and $review->hasReactionBar() ) ):\n$return .= <<<CONTENT\n\n\t\t<div class='ipsItemControls'>\n\t\t\t\nCONTENT;\n\nif ( $review->hidden() !== 1 && \\IPS\\IPS::classUsesTrait( $review, 'IPS\\Content\\Reactable' ) and \\IPS\\Settings::i()->reputation_enabled ):\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\" )->reputation( $review );\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\nif ( $review->hidden() === 1 && ( $review->canUnhide() || $review->canDelete() ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t<ul class='ipsComment_controls ipsClearfix ipsItemControls_left' data-role=\"commentControls\">\n\t\t\t\t\t\nCONTENT;\n\nif ( $review->hidden() === 1 && ( $review->canUnhide() || $review->canDelete() ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n\nif ( $review->canUnhide() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<li><a href='\nCONTENT;\n$return .= htmlspecialchars( $review->url('unhide')->csrf(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' class='ipsButton ipsButton_verySmall ipsButton_positive' data-action='approveComment'><i class='fa fa-check'><\/i> \nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'approve', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n\nif ( $review->canDelete() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<li><a href='\nCONTENT;\n$return .= htmlspecialchars( $review->url('delete')->csrf()->setPage('page',\\IPS\\Request::i()->page), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-action='deleteComment' data-updateOnDelete=\"#commentCount\" class='ipsButton ipsButton_verySmall ipsButton_negative'><i class='fa fa-times'><\/i> \nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'delete', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n\nif ( $review->canEdit() || $review->canSplit() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<a href='#elControlsReviewsSub_\nCONTENT;\n$return .= htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_menu' id='elControlsReviewsSub_\nCONTENT;\n$return .= htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-ipsMenu data-ipsMenu-appendTo='#review-\nCONTENT;\n$return .= htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_wrap'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'options', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n &nbsp;<i class='fa fa-caret-down'><\/i><\/a>\n\t\t\t\t\t\t\t\t<ul id='elControlsReviewsSub_\nCONTENT;\n$return .= htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_menu' class='ipsMenu ipsMenu_narrow ipsHide'>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $review->canEdit() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $review->mapped('first') and $review->item()->canEdit() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nCONTENT;\n$return .= htmlspecialchars( $review->item()->url()->setQueryString( 'do', 'edit' ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'edit', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nCONTENT;\n$return .= htmlspecialchars( $review->url('edit'), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-action='editComment'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'edit', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $review->canSplit() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nCONTENT;\n$return .= htmlspecialchars( $review->url('split'), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-action='splitComment' data-ipsDialog data-ipsDialog-title=\"\nCONTENT;\n\n$sprintf = array(\\IPS\\Member::loggedIn()->language()->addToStack( $item::$title )); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'split_to_new', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'split', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<\/ul>\n\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li class='ipsHide' data-role='commentLoading'>\n\t\t\t\t\t\t<span class='ipsLoading ipsLoading_tiny ipsLoading_noAnim'><\/span>\n\t\t\t\t\t<\/li>\n\t\t\t\t<\/ul>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<\/div>\n\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\n\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\" )->sharemenu( $review );\n$return .= <<<CONTENT\n\n<\/div>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction reviewContainer( $item, $review ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\nCONTENT;\n\n$idField = $review::$databaseColumnId;\n$return .= <<<CONTENT\n\n\nCONTENT;\n\nif ( $review->isIgnored() ):\n$return .= <<<CONTENT\n\n\t<div class='ipsComment ipsComment_ignored ipsPad_half ipsType_light'>\n\t\t\nCONTENT;\n\n$sprintf = array($review->author()->name); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'ignoring_content', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\n\t<\/div>\n\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t<a id='review-\nCONTENT;\n$return .= htmlspecialchars( $review->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'><\/a>\n\t<article id=\"elReview_\nCONTENT;\n$return .= htmlspecialchars( $review->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class=\"ipsBox ipsBox--child ipsComment ipsComment_parent ipsClearfix ipsClear \nCONTENT;\n\nif ( $review->hidden() OR $item->hidden() == -2 ):\n$return .= <<<CONTENT\nipsModerated\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\">\n\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"gallery\" )->review( $item, $review, $item::$formLangPrefix . 'review', $item::$application, $item::$module );\n$return .= <<<CONTENT\n\n\t<\/article>\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction searchResultAlbumCommentSnippet( $indexData, $itemData, $images, $url, $reviewRating, $condensed ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\nCONTENT;\n\nif ( $condensed ):\n$return .= <<<CONTENT\n\n\t\nCONTENT;\n\nif ( \\count( $images ) ):\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\n$firstImage = array_shift( $images );\n$return .= <<<CONTENT\n\n\t\t<span data-ipsLazyLoad class='ipsThumb_bg ipsThumb_small ipsPos_left cGallerySearchAlbumThumb' \nCONTENT;\n\nif ( \\IPS\\Settings::i()->lazy_load_enabled ):\n$return .= <<<CONTENT\ndata-background-src=\"\nCONTENT;\n\n$return .= str_replace( array( '(', ')' ), array( '\\(', '\\)' ), \\IPS\\File::get( 'gallery_Images', $firstImage->small_file_name )->url );;\n$return .= <<<CONTENT\n\"\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\nstyle='background-image: url(\nCONTENT;\n\n$return .= str_replace( array( '(', ')' ), array( '\\(', '\\)' ), \\IPS\\File::get( 'gallery_Images', $firstImage->small_file_name )->url );;\n$return .= <<<CONTENT\n)'\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n>\n\t\t\t<img \nCONTENT;\n\nif ( \\IPS\\Settings::i()->lazy_load_enabled ):\n$return .= <<<CONTENT\nsrc=\"\nCONTENT;\n\n$return .= htmlspecialchars( \\IPS\\Text\\Parser::blankImage(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" data-\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\nsrc='\nCONTENT;\n\n$return .= htmlspecialchars( \\IPS\\Text\\Parser::blankImage(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-src='\nCONTENT;\n\n$return .= \\IPS\\File::get( \"gallery_Images\", $firstImage->small_file_name )->url;\n$return .= <<<CONTENT\n' alt=\"\nCONTENT;\n$return .= htmlspecialchars( $firstImage->caption, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\n\t\t<\/span>\n\t\t<ul class='ipsList_inline cGallerySearchAlbumThumbs ipsType_noBreak' data-ipsLazyLoad>\n\t\t\t\nCONTENT;\n\nforeach ( $images as $image  ):\n$return .= <<<CONTENT\n\n\t\t\t\t<li>\n\t\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $image->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\n\t\t\t\t\t\t<span class='ipsThumb_bg ipsThumb_small ipsPos_left' \nCONTENT;\n\nif ( \\IPS\\Settings::i()->lazy_load_enabled ):\n$return .= <<<CONTENT\ndata-background-src=\"\nCONTENT;\n\n$return .= str_replace( array( '(', ')' ), array( '\\(', '\\)' ), \\IPS\\File::get( 'gallery_Images', $image->small_file_name )->url );;\n$return .= <<<CONTENT\n\"\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\nstyle='background-image: url(\nCONTENT;\n\n$return .= str_replace( array( '(', ')' ), array( '\\(', '\\)' ), \\IPS\\File::get( 'gallery_Images', $image->small_file_name )->url );;\n$return .= <<<CONTENT\n)'\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n>\n\t\t\t\t\t\t\t<img \nCONTENT;\n\nif ( \\IPS\\Settings::i()->lazy_load_enabled ):\n$return .= <<<CONTENT\nsrc=\"\nCONTENT;\n\n$return .= htmlspecialchars( \\IPS\\Text\\Parser::blankImage(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" data-\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\nsrc='\nCONTENT;\n\n$return .= \\IPS\\File::get( \"gallery_Images\", $image->small_file_name )->url;\n$return .= <<<CONTENT\n' alt=\"\nCONTENT;\n$return .= htmlspecialchars( $image->caption, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\n\t\t\t\t\t\t<\/span>\n\t\t\t\t\t<\/a>\n\t\t\t\t<\/li>\n\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t<\/ul>\n\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t<span class='ipsNoThumb ipsThumb_small ipsPos_left'><\/span>\n\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t<div class='ipsColumns ipsColumns_collapsePhone ipsColumns_noSpacing' data-ipsLazyLoad>\n\t\t<div class='ipsColumn ipsColumn_narrow ipsType_center'>\n\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $url, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' title='\nCONTENT;\n\n$sprintf = array($itemData['album_name']); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'view_this_album', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n'>\n\t\t\t\t\nCONTENT;\n\nif ( \\count( $images ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\n$firstImage = array_shift( $images );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nif ( \\IPS\\Settings::i()->lazy_load_enabled ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<img src='\nCONTENT;\n\n$return .= htmlspecialchars( \\IPS\\Text\\Parser::blankImage(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-src='\nCONTENT;\n\n$return .= \\IPS\\File::get( \"gallery_Images\", $firstImage->small_file_name )->url;\n$return .= <<<CONTENT\n' alt=\"\nCONTENT;\n$return .= htmlspecialchars( $firstImage->caption, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class=\"ipsImage ipsStream_thumbnail ipsStream_thumbnailSmall\">\n\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<img src='\nCONTENT;\n\n$return .= \\IPS\\File::get( \"gallery_Images\", $firstImage->small_file_name )->url;\n$return .= <<<CONTENT\n' alt=\"\nCONTENT;\n$return .= htmlspecialchars( $firstImage->caption, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class=\"ipsImage ipsStream_thumbnail ipsStream_thumbnailSmall\">\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t<div class='ipsThumb_small ipsNoThumb'><\/div>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t<\/a>\n\t\t<\/div>\n\t\t<div class='ipsColumn ipsColumn_fluid'>\n\t\t\t<div class='ipsStream_comment ipsPad'>\n\t\t\t\t\nCONTENT;\n\nif ( $reviewRating !== NULL ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\" )->rating( 'medium', $reviewRating );\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nif ( trim( $indexData['index_content'] ) !== '' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<div class='ipsType_richText ipsType_break ipsType_medium' \nCONTENT;\n\nif ( !( \\IPS\\Dispatcher::i()->application->directory == 'core' and \\IPS\\Dispatcher::i()->module and \\IPS\\Dispatcher::i()->module->key == 'search' ) ):\n$return .= <<<CONTENT\ndata-ipsTruncate data-ipsTruncate-type='remove' data-ipsTruncate-size='3 lines' data-ipsTruncate-watch='false'\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\ndata-searchable data-findTerm\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n>\n\t\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Content\\Search\\Result::preDisplay( $indexData['index_content'] );\n$return .= <<<CONTENT\n\n\t\t\t\t\t<\/div>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t<\/div>\n\t\t\t<ul class='ipsList_inline cGallerySearchAlbumThumbs cGallerySearchExpanded ipsType_noBreak ipsSpacer_top'>\n\t\t\t\t\nCONTENT;\n\nforeach ( $images as $image  ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $image->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\n\t\t\t\t\t\t\t<span class='ipsThumb_bg ipsThumb_small ipsPos_left' \nCONTENT;\n\nif ( \\IPS\\Settings::i()->lazy_load_enabled ):\n$return .= <<<CONTENT\ndata-background-src=\"\nCONTENT;\n\n$return .= str_replace( array( '(', ')' ), array( '\\(', '\\)' ), \\IPS\\File::get( 'gallery_Images', $image->small_file_name )->url );;\n$return .= <<<CONTENT\n\"\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\nstyle='background-image: url(\nCONTENT;\n\n$return .= str_replace( array( '(', ')' ), array( '\\(', '\\)' ), \\IPS\\File::get( 'gallery_Images', $image->small_file_name )->url );;\n$return .= <<<CONTENT\n)'\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n>\n\t\t\t\t\t\t\t\t<img \nCONTENT;\n\nif ( \\IPS\\Settings::i()->lazy_load_enabled ):\n$return .= <<<CONTENT\nsrc=\"\nCONTENT;\n\n$return .= htmlspecialchars( \\IPS\\Text\\Parser::blankImage(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" data-\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\nsrc='\nCONTENT;\n\n$return .= \\IPS\\File::get( \"gallery_Images\", $image->small_file_name )->url;\n$return .= <<<CONTENT\n' alt=\"\nCONTENT;\n$return .= htmlspecialchars( $image->caption, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\n\t\t\t\t\t\t\t<\/span>\n\t\t\t\t\t\t<\/a>\n\t\t\t\t\t<\/li>\n\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t<\/ul>\n\t\t<\/div>\n\t<\/div>\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction searchResultAlbumSnippet( $indexData, $itemData, $images, $url, $condensed ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\nCONTENT;\n\nif ( $condensed ):\n$return .= <<<CONTENT\n\n\t\nCONTENT;\n\nif ( \\count( $images ) ):\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\n$firstImage = array_shift( $images );\n$return .= <<<CONTENT\n\n\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $firstImage->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\n\t\t\t<span data-ipsLazyLoad class='ipsThumb_bg ipsThumb_small ipsPos_left' \nCONTENT;\n\nif ( \\IPS\\Settings::i()->lazy_load_enabled ):\n$return .= <<<CONTENT\ndata-background-src=\"\nCONTENT;\n\n$return .= str_replace( array( '(', ')' ), array( '\\(', '\\)' ), \\IPS\\File::get( 'gallery_Images', $firstImage->small_file_name )->url );;\n$return .= <<<CONTENT\n\"\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\nstyle='background-image: url(\nCONTENT;\n\n$return .= str_replace( array( '(', ')' ), array( '\\(', '\\)' ), \\IPS\\File::get( 'gallery_Images', $firstImage->small_file_name )->url );;\n$return .= <<<CONTENT\n)'\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n>\n\t\t\t\t<img \nCONTENT;\n\nif ( \\IPS\\Settings::i()->lazy_load_enabled ):\n$return .= <<<CONTENT\nsrc=\"\nCONTENT;\n\n$return .= htmlspecialchars( \\IPS\\Text\\Parser::blankImage(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" data-\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\nsrc='\nCONTENT;\n\n$return .= \\IPS\\File::get( \"gallery_Images\", $firstImage->small_file_name )->url;\n$return .= <<<CONTENT\n' alt=\"\nCONTENT;\n$return .= htmlspecialchars( $firstImage->caption, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class=\"\">\n\t\t\t<\/span>\n\t\t<\/a>\n\t\t<ul class='ipsList_inline cGallerySearchAlbumThumbs ipsType_noBreak' data-ipsLazyLoad>\n\t\t\t\nCONTENT;\n\nforeach ( $images as $image  ):\n$return .= <<<CONTENT\n\n\t\t\t\t<li>\n\t\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $image->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\n\t\t\t\t\t\t<span class='ipsThumb_bg ipsThumb_small ipsPos_left' \nCONTENT;\n\nif ( \\IPS\\Settings::i()->lazy_load_enabled ):\n$return .= <<<CONTENT\ndata-background-src=\"\nCONTENT;\n\n$return .= str_replace( array( '(', ')' ), array( '\\(', '\\)' ), \\IPS\\File::get( 'gallery_Images', $image->small_file_name )->url );;\n$return .= <<<CONTENT\n\"\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\nstyle='background-image: url(\nCONTENT;\n\n$return .= str_replace( array( '(', ')' ), array( '\\(', '\\)' ), \\IPS\\File::get( 'gallery_Images', $image->small_file_name )->url );;\n$return .= <<<CONTENT\n)'\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n>\n\t\t\t\t\t\t\t<img \nCONTENT;\n\nif ( \\IPS\\Settings::i()->lazy_load_enabled ):\n$return .= <<<CONTENT\nsrc=\"\nCONTENT;\n\n$return .= htmlspecialchars( \\IPS\\Text\\Parser::blankImage(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" data-\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\nsrc='\nCONTENT;\n\n$return .= \\IPS\\File::get( \"gallery_Images\", $image->small_file_name )->url;\n$return .= <<<CONTENT\n' alt=\"\nCONTENT;\n$return .= htmlspecialchars( $image->caption, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\n\t\t\t\t\t\t<\/span>\n\t\t\t\t\t<\/a>\n\t\t\t\t<\/li>\n\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t<\/ul>\n\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t<span class='ipsNoThumb ipsThumb_small ipsPos_left'><\/span>\n\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\nCONTENT;\n\nif ( trim( $indexData['index_content'] ) !== '' ):\n$return .= <<<CONTENT\n\n\t\t<div class='ipsType_richText ipsType_break ipsType_medium' \nCONTENT;\n\nif ( !( \\IPS\\Dispatcher::i()->application->directory == 'core' and \\IPS\\Dispatcher::i()->module and \\IPS\\Dispatcher::i()->module->key == 'search' ) ):\n$return .= <<<CONTENT\ndata-ipsTruncate data-ipsTruncate-type='remove' data-ipsTruncate-size='3 lines' data-ipsTruncate-watch='false'\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\ndata-searchable data-findTerm\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n>\n\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Content\\Search\\Result::preDisplay( $indexData['index_content'] );\n$return .= <<<CONTENT\n\n\t\t<\/div>\n\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\n\t\nCONTENT;\n\nif ( \\count($images) ):\n$return .= <<<CONTENT\n\n\t\t<div class='cGalleryAlbums_recent ipsMargin_top' data-ipsLazyLoad>\n\t\t\t<ul class='ipsList_reset'>\n\t\t\t\t\nCONTENT;\n\nforeach ( $images as $k => $image ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li \nCONTENT;\n\nif ( \\IPS\\Settings::i()->lazy_load_enabled ):\n$return .= <<<CONTENT\ndata-background-src=\"\nCONTENT;\n\n$return .= str_replace( array( '(', ')' ), array( '\\(', '\\)' ), \\IPS\\File::get( 'gallery_Images', $image->small_file_name )->url );;\n$return .= <<<CONTENT\n\"\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\nstyle='background-image: url(\nCONTENT;\n\n$return .= str_replace( array( '(', ')' ), array( '\\(', '\\)' ), \\IPS\\File::get( 'gallery_Images', $image->small_file_name )->url );;\n$return .= <<<CONTENT\n)'\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n class='cGalleryTrimmedImage'>\n\t\t\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $image->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\n\t\t\t\t\t\t\t<img \nCONTENT;\n\nif ( \\IPS\\Settings::i()->lazy_load_enabled ):\n$return .= <<<CONTENT\nsrc=\"\nCONTENT;\n\n$return .= htmlspecialchars( \\IPS\\Text\\Parser::blankImage(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" data-\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\nsrc='\nCONTENT;\n\n$return .= \\IPS\\File::get( \"gallery_Images\", $image->small_file_name )->url;\n$return .= <<<CONTENT\n' alt=\"\nCONTENT;\n$return .= htmlspecialchars( $image->caption, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\n\t\t\t\t\t\t<\/a>\n\t\t\t\t\t<\/li>\n\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t<\/ul>\n\t\t<\/div>\n\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction searchResultCommentSnippet( $indexData, $itemData, $image, $url, $reviewRating, $condensed ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\nCONTENT;\n\nif ( $condensed ):\n$return .= <<<CONTENT\n\n\t\nCONTENT;\n\nif ( $image ):\n$return .= <<<CONTENT\n\n\t\t<span data-ipsLazyLoad class='ipsThumb_bg ipsThumb_small ipsPos_left' \nCONTENT;\n\nif ( \\IPS\\Settings::i()->lazy_load_enabled ):\n$return .= <<<CONTENT\ndata-background-src=\"\nCONTENT;\n\n$return .= str_replace( array( '(', ')' ), array( '\\(', '\\)' ), (string) \\IPS\\File::get( 'gallery_Images', $image )->url );;\n$return .= <<<CONTENT\n\"\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\nstyle='background-image: url(\nCONTENT;\n\n$return .= str_replace( array( '(', ')' ), array( '\\(', '\\)' ), (string) \\IPS\\File::get( 'gallery_Images', $image )->url );;\n$return .= <<<CONTENT\n)'\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n>\n\t\t\t<img \nCONTENT;\n\nif ( \\IPS\\Settings::i()->lazy_load_enabled ):\n$return .= <<<CONTENT\nsrc=\"\nCONTENT;\n\n$return .= htmlspecialchars( \\IPS\\Text\\Parser::blankImage(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" data-\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\nsrc='\nCONTENT;\n\n$return .= \\IPS\\File::get( \"gallery_Images\", $image )->url;\n$return .= <<<CONTENT\n' alt=\"\nCONTENT;\n$return .= htmlspecialchars( $itemData['image_caption'], ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\n\t\t<\/span>\n\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t<span class='ipsNoThumb ipsThumb_small ipsPos_left'><\/span>\n\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t<div class='ipsColumns ipsColumns_collapsePhone ipsColumns_noSpacing'>\n\t\t<div class='ipsColumn ipsColumn_narrow ipsType_center'>\n\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $url, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' title='\nCONTENT;\n\n$sprintf = array($itemData['image_caption']); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'view_this_image', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n'>\n\t\t\t\t\nCONTENT;\n\nif ( $image ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nif ( \\IPS\\Settings::i()->lazy_load_enabled ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<img data-ipsLazyLoad src='\nCONTENT;\n\n$return .= htmlspecialchars( \\IPS\\Text\\Parser::blankImage(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-src='\nCONTENT;\n\n$return .= \\IPS\\File::get( \"gallery_Images\", $image )->url;\n$return .= <<<CONTENT\n'alt=\"\nCONTENT;\n$return .= htmlspecialchars( $itemData['image_caption'], ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class=\"ipsImage ipsStream_thumbnail ipsStream_thumbnailSmall\">\n\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<img src='\nCONTENT;\n\n$return .= \\IPS\\File::get( \"gallery_Images\", $image )->url;\n$return .= <<<CONTENT\n'alt=\"\nCONTENT;\n$return .= htmlspecialchars( $itemData['image_caption'], ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class=\"ipsImage ipsStream_thumbnail ipsStream_thumbnailSmall\">\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t<div class='ipsNoThumb_medium ipsNoThumb'><\/div>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t<\/a>\n\t\t<\/div>\n\t\t<div class='ipsColumn ipsColumn_fluid'>\n\t\t\t<div class='ipsStream_comment ipsPad'>\n\t\t\t\t\nCONTENT;\n\nif ( $reviewRating !== NULL ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\" )->rating( 'medium', $reviewRating );\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nif ( trim( $indexData['index_content'] ) !== '' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<div class='ipsType_richText ipsType_break ipsType_medium' \nCONTENT;\n\nif ( !( \\IPS\\Dispatcher::i()->application->directory == 'core' and \\IPS\\Dispatcher::i()->module and \\IPS\\Dispatcher::i()->module->key == 'search' ) ):\n$return .= <<<CONTENT\ndata-ipsTruncate data-ipsTruncate-type='remove' data-ipsTruncate-size='3 lines' data-ipsTruncate-watch='false'\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\ndata-searchable data-findTerm\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n>\n\t\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Content\\Search\\Result::preDisplay( $indexData['index_content'] );\n$return .= <<<CONTENT\n\n\t\t\t\t\t<\/div>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t<\/div>\n\t\t<\/div>\n\t<\/div>\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction searchResultImageSnippet( $indexData, $itemData, $albumData, $image, $url, $condensed ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\nCONTENT;\n\nif ( $condensed ):\n$return .= <<<CONTENT\n\n\t\nCONTENT;\n\nif ( $image ):\n$return .= <<<CONTENT\n\n\t\t<span data-ipsLazyLoad class='ipsThumb_bg ipsThumb_small ipsPos_left' \nCONTENT;\n\nif ( \\IPS\\Settings::i()->lazy_load_enabled ):\n$return .= <<<CONTENT\ndata-background-src=\"\nCONTENT;\n\n$return .= str_replace( array( '(', ')' ), array( '\\(', '\\)' ), (string) \\IPS\\File::get( 'gallery_Images', $image )->url );;\n$return .= <<<CONTENT\n\"\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\nstyle='background-image: url(\nCONTENT;\n\n$return .= str_replace( array( '(', ')' ), array( '\\(', '\\)' ), (string) \\IPS\\File::get( 'gallery_Images', $image )->url );;\n$return .= <<<CONTENT\n)'\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n>\n\t\t\t<img \nCONTENT;\n\nif ( \\IPS\\Settings::i()->lazy_load_enabled ):\n$return .= <<<CONTENT\nsrc=\"\nCONTENT;\n\n$return .= htmlspecialchars( \\IPS\\Text\\Parser::blankImage(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" data-\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\nsrc='\nCONTENT;\n\n$return .= \\IPS\\File::get( \"gallery_Images\", $image )->url;\n$return .= <<<CONTENT\n' alt=\"\nCONTENT;\n$return .= htmlspecialchars( $indexData['index_title'], ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\n\t\t<\/span>\n\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t<span class='ipsNoThumb ipsThumb_small ipsPos_left'><\/span>\n\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t<div class='ipsStreamItem_columns'>\n\t\t\nCONTENT;\n\nif ( $image ):\n$return .= <<<CONTENT\n\n\t\t\t<div class='ipsStreamItem_columns__thumb cGalleryStreamPreview'>\n\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $url, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' title='\nCONTENT;\n\n$sprintf = array($indexData['index_title']); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'view_this_image', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n'>\n\t\t\t\t\t\nCONTENT;\n\nif ( \\IPS\\Settings::i()->lazy_load_enabled ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<img data-ipsLazyLoad src='\nCONTENT;\n\n$return .= htmlspecialchars( \\IPS\\Text\\Parser::blankImage(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-src='\nCONTENT;\n\n$return .= \\IPS\\File::get( \"gallery_Images\", $image )->url;\n$return .= <<<CONTENT\n' alt=\"\nCONTENT;\n$return .= htmlspecialchars( $indexData['index_title'], ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class=\"ipsImage ipsStream_thumbnail\">\n\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<img src='\nCONTENT;\n\n$return .= \\IPS\\File::get( \"gallery_Images\", $image )->url;\n$return .= <<<CONTENT\n' alt=\"\nCONTENT;\n$return .= htmlspecialchars( $indexData['index_title'], ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class=\"ipsImage ipsStream_thumbnail\">\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\t\t\t\t\n\t\t\t\t<\/a>\n\t\t\t<\/div>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<div class='ipsStreamItem_columns__content'>\n\t\t\t\nCONTENT;\n\nif ( $albumData ):\n$return .= <<<CONTENT\n\n\t\t\t\t<p class='ipsType_reset ipsType_normal ipsType_light'>\n\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'from_the_album', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n <a href='\nCONTENT;\n\n$return .= htmlspecialchars( \\IPS\\Http\\Url::internal( \"app=gallery&module=gallery&controller=browse&album={$albumData['album_id']}\", null, \"gallery_album\", array( $albumData['album_name_seo'] ), 0 ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', TRUE );\n$return .= <<<CONTENT\n'>\nCONTENT;\n$return .= htmlspecialchars( $albumData['album_name'], ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t<\/p>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\nif ( trim( $indexData['index_content'] ) !== '' ):\n$return .= <<<CONTENT\n\n\t\t\t\t<div class='ipsType_richText ipsType_break ipsType_medium' \nCONTENT;\n\nif ( !( \\IPS\\Dispatcher::i()->application->directory == 'core' and \\IPS\\Dispatcher::i()->module and \\IPS\\Dispatcher::i()->module->key == 'search' ) ):\n$return .= <<<CONTENT\ndata-ipsTruncate data-ipsTruncate-type='remove' data-ipsTruncate-size='3 lines' data-ipsTruncate-watch='false'\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\ndata-searchable data-findTerm\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n>\n\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Content\\Search\\Result::preDisplay( $indexData['index_content'] );\n$return .= <<<CONTENT\n\n\t\t\t\t<\/div>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\n\t\t\t\nCONTENT;\n\nif ( $itemData['image_copyright'] ):\n$return .= <<<CONTENT\n\n\t\t\t\t<p class='ipsSpacer_top ipsType_light ipsType_medium ipsType_reset'>\n\t\t\t\t\t&copy; \nCONTENT;\n$return .= htmlspecialchars( $itemData['image_copyright'], ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t<\/p>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<\/div>\n\t<\/div>\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\nCONTENT;\n\n\t\treturn $return;\n}}"
VALUE;
